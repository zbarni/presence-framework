<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">SIP Presence Service User Guide</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="description" content="The Mobicents Platform is the first and only open source VoIP platform certified for JAIN SLEE 1.0 and SIP Servlets 1.1 compliance. Mobicents serves as a high-performance core for Service Delivery Platforms (SDPs) and IP Multimedia Subsystems (IMSes) by leveraging J2EE to enable the convergence of data and video in Next-Generation Intelligent Network (NGIN) applications. The Mobicents SIP Presence Service, provides presence functionalities to SIP-based networks, and is built upon Mobicents JAIN SLEE."/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e1"/>SIP Presence Service User Guide</h1></div><div><h2 class="subtitle">The user guide for the Mobicents SIP Presence Service</h2></div><div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="authorgroup"><div class="authors">by <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Douglas</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Silas</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Eduardo</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Martins</span>, <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Jared</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Morgan</span>, and <span xmlns="http://www.w3.org/1999/xhtml" class="firstname">Tom</span> <span xmlns="http://www.w3.org/1999/xhtml" class="surname">Wells</span></div><div class="editors"/><div class="others"/></div></div><div><p class="copyright">Copyright © 2010 Red Hat, Inc.</p></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p><span class="application"><strong>The Mobicents Platform</strong></span> is the first and only open source <acronym class="acronym">VoIP</acronym> platform certified for <acronym class="acronym">JAIN SLEE</acronym> 1.0 and <acronym class="acronym">SIP</acronym> Servlets 1.1 compliance. <span class="application"><strong>Mobicents</strong></span> serves as a high-performance core for Service Delivery Platforms (<acronym class="acronym">SDP</acronym>s) and <acronym class="acronym">IP</acronym> Multimedia Subsystems (<acronym class="acronym">IMS</acronym>es) by leveraging <acronym class="acronym">J2EE</acronym> to enable the convergence of data and video in Next-Generation Intelligent Network (<acronym class="acronym">NGIN</acronym>) applications.</p><p>The <span class="application"><strong>Mobicents</strong></span> <span class="application"><strong>SIP Presence Service</strong></span>, provides presence functionalities to <acronym class="acronym">SIP</acronym>-based networks, and is built upon Mobicents <acronym class="acronym">JAIN SLEE</acronym>.</p></div></div></div><hr/></div><div class="toc"><dl><dt><span class="preface"><a href="#spsug-SIP_Presence_Service_User_Guide-Preface">Preface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e100">1. Document Conventions</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e110">1.1. Typographic Conventions</a></span></dt><dt><span class="section"><a href="#d0e326">1.2. Pull-quote Conventions</a></span></dt><dt><span class="section"><a href="#d0e345">1.3. Notes and Warnings</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e365">2. Provide feedback to the authors!</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Introduction_to_the_SIP_Presence_Service">1. Introduction to the Mobicents SIP Presence Service</a></span></dt><dd><dl><dt><span class="section"><a href="#Architecture_of_the_SIP_Presence_Service">1.1. Architecture of the Mobicents SIP Presence Service</a></span></dt></dl></dd><dt><span class="chapter"><a href="#itsps-Installing_the_SIP_Presence_Service">2. Installing the Mobicents SIP Presence Service</a></span></dt><dd><dl><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Installing_Configuring_and_Running">2.1. Mobicents SIP Presence Service: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-PreInstall_Requirements_and_Prerequisites">2.1.1. Pre-Install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Downloading">2.1.2. Downloading</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Configuring">2.1.3. Configuring (and Setting JBOSS_HOME)</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Installing">2.1.4. Installing</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Running">2.1.5. Running</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Stopping">2.1.6. Stopping</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Uninstalling">2.1.7. Uninstalling</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Building_From_Source">2.1.8. Building from Source Project</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Binary_Releases_Daily_Snapshots">2.1.9. Binary Releases Daily Snapshots</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xdms-XML_Document_Management_Server">3. Mobicents XML Document Management Server</a></span></dt><dd><dl><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server">3.1. Configuring the XDM Server</a></span></dt><dd><dl><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_XCAP_ROOT">3.1.1. Configuring the XDM Server XCAP root</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_XCAP_Interface">3.1.2. Other configurations in the XDM Server XCAP Interface</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_SIP_Interface">3.1.3. Configuring the XDM Server XCAP Diff SIP Subscription Interface</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_Users">3.1.4. XDM Server User Profile Provisioning</a></span></dt><dt><span class="section"><a href="#xdm-xcap_app_usages">3.1.5. XCAP Application Usages</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#sps-SIP_Presence_Server">4. Mobicents SIP Presence Server</a></span></dt><dd><dl><dt><span class="section"><a href="#sps-Functional_Architecture_of_the_SIP_Presence_Server">4.1. Functional Architecture of the SIP Presence Server</a></span></dt><dt><span class="section"><a href="#sps-Configuring_The_Sip_Presence_Server">4.2. Configuring The SIP Presence Server</a></span></dt><dd><dl><dt><span class="section"><a href="#sps-Configuring_the_Abstract_SIP_Event_Publication_Interface">4.2.1. Configuring the Abstract SIP Event Publication Interface</a></span></dt><dt><span class="section"><a href="#sps-Configuring_the_Abstract_SIP_Event_Subscription_Interface">4.2.2. Configuring the Abstract SIP Event Subscription Interface</a></span></dt><dt><span class="section"><a href="#sps-Configuring_the_Concrete_SIP_Event_Interfaces">4.2.3. Configuring the Concrete SIP Event Interfaces</a></span></dt></dl></dd><dt><span class="section"><a href="#sps-Content_Accepted_By_The_Sip_Presence_Server">4.3. Content accepted by the SIP Presence Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#rls-Resource_List_Server">5. Mobicents Resource List Server</a></span></dt><dd><dl><dt><span class="section"><a href="#rls-Disabling_the_RLS">5.1. Disabling the Resource List Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#msps-Client_Applications">6. Client JAIN SLEE Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#msps-XDM_Client_Enabler">6.1. XDM Client JAIN SLEE Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler">6.2. The Mobicents SIP Event Publication Client Enabler</a></span></dt><dd><dl><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler-integrating">6.2.1. Integrating the Mobicents SIP Event Publication Client Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler--using">6.2.2. Using the Mobicents SIP Event Publication Client Enabler</a></span></dt></dl></dd><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler">6.3. The Mobicents SIP Event Subscription Client Enabler</a></span></dt><dd><dl><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler-integrating">6.3.1. Integrating the Mobicents SIP Event Subscription Client Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler-using">6.3.2. Using the Mobicents SIP Event Subscription Client Enabler</a></span></dt></dl></dd><dt><span class="section"><a href="#msps-Client_Application_Examples">6.4. Client Application Examples</a></span></dt></dl></dd><dt><span class="chapter"><a href="#logging_traces_and_alarms">7. Logging, Traces and Alarms</a></span></dt><dd><dl><dt><span class="section"><a href="#log4j_service">7.1. Log4j Logging Service</a></span></dt><dd><dl><dt><span class="section"><a href="#global_logging_config">7.1.1. Simplified Global Log4j Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#alarm_facility">7.2. Alarms</a></span></dt><dt><span class="section"><a href="#trace_facility">7.3. Trace Facility</a></span></dt><dd><dl><dt><span class="section"><a href="#tracers_vs_log4j">7.3.1. JAIN SLEE Tracers and Log4j</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#spsug-appe-Publican-Revision_History">A. Revision History</a></span></dt><dt><span class="index"><a href="#d0e2630">Index</a></span></dt></dl></div><div class="preface" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spsug-SIP_Presence_Service_User_Guide-Preface"/>Preface</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e100"/>1. Document Conventions</h2></div></div></div><p>
		This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.
	</p><p>
		In PDF and paper editions, this manual uses typefaces drawn from the <a class="ulink" href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set. The Liberation Fonts set is also used in HTML editions if the set is installed on your system. If not, alternative but equivalent typefaces are displayed. Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.
	</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e110"/>1.1. Typographic Conventions</h3></div></div></div><p>
			Four typographic conventions are used to call attention to specific words and phrases. These conventions, and the circumstances they apply to, are as follows.
		</p><p>
			<code class="literal">Mono-spaced Bold</code>
		</p><p>
			Used to highlight system input, including shell commands, file names and paths. Also used to highlight key caps and key-combinations. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				To see the contents of the file <code class="filename">my_next_bestselling_novel</code> in your current working directory, enter the <code class="command">cat my_next_bestselling_novel</code> command at the shell prompt and press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</p></blockquote></div><p>
			The above includes a file name, a shell command and a key cap, all presented in Mono-spaced Bold and all distinguishable thanks to context.
		</p><p>
			Key-combinations can be distinguished from key caps by the hyphen connecting each part of a key-combination. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				Press <span class="keycap"><strong>Enter</strong></span> to execute the command.
			</p><p>
				Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> to switch to the first virtual terminal. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F7</strong></span> to return to your X-Windows session.
			</p></blockquote></div><p>
			The first sentence highlights the particular key cap to press. The second highlights two sets of three key caps, each set pressed simultaneously.
		</p><p>
			If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code class="literal">Mono-spaced Bold</code>. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				File-related classes include <code class="classname">filesystem</code> for file systems, <code class="classname">file</code> for files, and <code class="classname">dir</code> for directories. Each class has its own associated set of permissions.
			</p></blockquote></div><p>
			<span class="application"><strong>Proportional Bold</strong></span>
		</p><p>
			This denotes words or phrases encountered on a system, including application names; dialogue box text; labelled buttons; check-box and radio button labels; menu titles and sub-menu titles. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				Choose <span class="guimenu"><strong>System &gt; Preferences &gt; Mouse</strong></span> from the main menu bar to launch <span class="application"><strong>Mouse Preferences</strong></span>. In the <span class="guilabel"><strong>Buttons</strong></span> tab, click the <span class="guilabel"><strong>Left-handed mouse</strong></span> check box and click <span class="guibutton"><strong>Close</strong></span> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).
			</p><p>
				To insert a special character into a <span class="application"><strong>gedit</strong></span> file, choose <span class="guimenu"><strong>Applications &gt; Accessories &gt; Character Map</strong></span> from the main menu bar. Next, choose <span class="guimenu"><strong>Search &gt; Find</strong></span> from the <span class="application"><strong>Character Map</strong></span> menu bar, type the name of the character in the <span class="guilabel"><strong>Search</strong></span> field and click <span class="guibutton"><strong>Next</strong></span>. The character you sought will be highlighted in the <span class="guilabel"><strong>Character Table</strong></span>. Double-click this highlighted character to place it in the <span class="guilabel"><strong>Text to copy</strong></span> field and then click the <span class="guibutton"><strong>Copy</strong></span> button. Now switch back to your document and choose <span class="guimenu"><strong>Edit &gt; Paste</strong></span> from the <span class="application"><strong>gedit</strong></span> menu bar.
			</p></blockquote></div><p>
			The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in Proportional Bold and all distinguishable by context.
		</p><p>
			Note the <span class="guimenu"><strong>&gt;</strong></span> shorthand used to indicate traversal through a menu and its sub-menus. This is to avoid the difficult-to-follow 'Select <span class="guimenuitem"><strong>Mouse</strong></span> from the <span class="guimenu"><strong>Preferences</strong></span> sub-menu in the <span class="guimenu"><strong>System</strong></span> menu of the main menu bar' approach.
		</p><p>
			<code class="command"><em class="replaceable"><code>Mono-spaced Bold Italic</code></em></code> or <span class="application"><strong><em class="replaceable"><code>Proportional Bold Italic</code></em></strong></span>
		</p><p>
			Whether Mono-spaced Bold or Proportional Bold, the addition of Italics indicates replaceable or variable text. Italics denotes text you do not input literally or displayed text that changes depending on circumstance. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				To connect to a remote machine using ssh, type <code class="command">ssh <em class="replaceable"><code>username</code></em>@<em class="replaceable"><code>domain.name</code></em></code> at a shell prompt. If the remote machine is <code class="filename">example.com</code> and your username on that machine is john, type <code class="command">ssh john@example.com</code>.
			</p><p>
				The <code class="command">mount -o remount <em class="replaceable"><code>file-system</code></em></code> command remounts the named file system. For example, to remount the <code class="filename">/home</code> file system, the command is <code class="command">mount -o remount /home</code>.
			</p><p>
				To see the version of a currently installed package, use the <code class="command">rpm -q <em class="replaceable"><code>package</code></em></code> command. It will return a result as follows: <code class="command"><em class="replaceable"><code>package-version-release</code></em></code>.
			</p></blockquote></div><p>
			Note the words in bold italics above  username, domain.name, file-system, package, version and release. Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.
		</p><p>
			Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term. For example:
		</p><div class="blockquote"><blockquote class="blockquote"><p>
				When the Apache HTTP Server accepts requests, it dispatches child processes or threads to handle them. This group of child processes or threads is known as a <em class="firstterm">server-pool</em>. Under Apache HTTP Server 2.0, the responsibility for creating and maintaining these server-pools has been abstracted to a group of modules called <em class="firstterm">Multi-Processing Modules</em> (<em class="firstterm">MPMs</em>). Unlike other modules, only one module from the MPM group can be loaded by the Apache HTTP Server.
			</p></blockquote></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e326"/>1.2. Pull-quote Conventions</h3></div></div></div><p>
			Two, commonly multi-line, data types are set off visually from the surrounding text.
		</p><p>
			Output sent to a terminal is set in <code class="computeroutput">Mono-spaced Roman</code> and presented thus:
		</p><pre class="screen">
books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs
</pre><p>
			Source-code listings are also set in <code class="computeroutput">Mono-spaced Roman</code> but are presented and highlighted as follows:
		</p><pre class="programlisting">
package org.jboss.book.jca.ex1;

import javax.naming.InitialContext;

public class ExClient
{
   public static void main(String args[]) 
       throws Exception
   {
      InitialContext iniCtx = new InitialContext();
      Object         ref    = iniCtx.lookup("EchoBean");
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.create();

      System.out.println("Created Echo");

      System.out.println("Echo.echo('Hello') = " + echo.echo("Hello"));
   }
   
}
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="d0e345"/>1.3. Notes and Warnings</h3></div></div></div><p>
			Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.
		</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>
				A note is a tip or shortcut or alternative approach to the task at hand. Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.
			</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
				Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply. Ignoring Important boxes won't cause data loss but may cause irritation and frustration.
			</p></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="warning"><h2>Warning</h2><p>
				A Warning should not be ignored. Ignoring warnings will most likely cause data loss.
			</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="d0e365"/>2. Provide feedback to the authors!</h2></div></div></div><a id="d0e368" class="indexterm"/><p> If you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in Bugzilla: <a class="ulink" href="http://bugzilla.redhat.com/bugzilla/">http://bugzilla.redhat.com/bugzilla/</a> against the product <span class="application"><strong>JBCP</strong></span>, or contact the authors.</p><p> When submitting a bug report, be sure to mention the manual's identifier: MSPS_User_Guide</p><p> If you have a suggestion for improving the documentation, try to be as specific as possible when describing it. If you have found an error, please include the section number and some of the surrounding text so we can find it easily.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Introduction_to_the_SIP_Presence_Service"/>Chapter 1. Introduction to the Mobicents SIP Presence Service</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#Architecture_of_the_SIP_Presence_Service">1.1. Architecture of the Mobicents SIP Presence Service</a></span></dt></dl></div><p>
		</p><div class="mediaobject" align="center"><a id="img-msps_standards"/><img src="images/msps_standards.jpg" align="middle"/><div class="caption"><p>Mobicents SIP Presence Service relation with standard groups</p></div></div><p>
	</p><p>The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> provides presence functionalities to SIP-based networks using standards developed by the Internet Engineering Task Force (IETF), the Open Mobile Alliance (OMA), the 3rd Generation Partnership Project (3GPP) and the European Telecommunications Standards Institute (ETSI).</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="Architecture_of_the_SIP_Presence_Service"/>1.1. Architecture of the Mobicents SIP Presence Service</h2></div></div></div><a id="d0e403" class="indexterm"/><p>The <span class="application"><strong>SIP Presence Service</strong></span> is comprised of three separate but interrelated servers.</p><p>
			</p><div class="mediaobject" align="center"><a id="img-msps_servers"/><img src="images/msps_servers.jpg" align="middle"/><div class="caption"><p>Mobicents SIP Presence Service servers</p></div></div><p>
		</p><div class="variablelist"><a id="ittsps-The_Three_Servers_Comprising_the_SIP_Presence_Service"/><p class="title"><b>The Three Servers Comprising the SIP Presence Service</b></p><dl><dt><span class="term">The SIP Presence Server</span></dt><dd><p>The <span class="application"><strong>Mobicents SIP Presence Server</strong></span> (<acronym class="acronym">PS</acronym>) is an entity that accepts, stores and distributes SIP Presence information. The Presence Server performs the following functions:</p><div class="itemizedlist"><ul><li><p>Manages publications from one or multiple presence source(s) of a certain <span class="emphasis"><em>presentity</em></span>. This includes refreshing presence information, replacing existing presence information with newly-published information, or removing presence information.</p></li><li><p>Manages subscriptions from watchers to presence information and generates notifications about presence information state changes, retrieving the presence authorization rules from the <span class="application"><strong>XDM Server</strong></span>.</p></li><li><p>Manages subscriptions from watcher information subscribers to watcher information and generates notifications about watcher information state changes.</p></li></ul></div></dd><dt><span class="term">The XML Document Management Server</span></dt><dd><p>The XML Document Management Server (XDMS) is a functional element of next-generation IP communications networks. It is responsible for handling the management of user XML documents stored on the network side, such as presence authorization rules, static presence information, contact and group lists (also known as “<span class="quote">resource lists</span>”), policy data, and many others.</p></dd><dt><span class="term">The Resource List Server</span></dt><dd><p>The Resource List Server (<acronym class="acronym">RLS</acronym>) handles subscriptions to presence lists. It creates and manages back-end subscriptions to all resources in the presence list. The list content is retrieved from the XDM Server.</p></dd></dl></div><p>
			</p><div class="mediaobject" align="center"><a id="ittsps-img-msps_integrated"/><img src="images/msps_integrated.jpg" align="middle"/><div class="caption"><p>Mobicents SIP Presence Service Integrated server</p></div></div><p>
		</p><p>A major advantage of the <span class="application"><strong>Mobicents</strong></span> SIP Presence Service is that, depending on your needs, each server can be deployed separately, or all servers can be integrated on the same host.</p><p>
			The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> is built on top of <span class="application"><strong>Mobicents JAIN SLEE</strong></span>, a high performance and scalable Application Server, and uses many additional Java Enterprise (<acronym class="acronym">JEE</acronym>) technologies, such as Java Persistence API (<acronym class="acronym">JPA</acronym>) to manage data.
		</p><p>
			</p><div class="mediaobject" align="center"><a id="ittsps-img-msps_implementation"/><img src="images/msps_implementation.jpg" align="middle"/><div class="caption"><p>Mobicents SIP Presence Service Integrated implementation</p></div></div><p>
		</p><p>In addition, there are JAIN SLEE internal client interfaces available for interaction with each server, which distinguish the <span class="application"><strong>Mobicents SIP Presence Service</strong></span> from other presence services.</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Resources and Further Information about the Mobicents SIP Presence Service</h5><p class="formalpara">For further information on the <span class="application"><strong>Mobicents</strong></span> <span class="application"><strong>SIP Presence Service</strong></span>, here is a list of additional resources:</p><div class="variablelist"><dl><dt><span class="term">Sources</span></dt><dd><p>
						<a class="ulink" href="http://mobicents.googlecode.com/svn/trunk/servers/sip-presence/">Source Code Location</a>
					</p></dd><dt><span class="term">Community</span></dt><dd><p>
						<a class="ulink" href="http://groups.google.com/group/mobicents-public">Mobicents Community</a>
					</p></dd></dl></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="itsps-Installing_the_SIP_Presence_Service"/>Chapter 2. Installing the Mobicents SIP Presence Service</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Installing_Configuring_and_Running">2.1. Mobicents SIP Presence Service: Installing, Configuring and Running</a></span></dt><dd><dl><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-PreInstall_Requirements_and_Prerequisites">2.1.1. Pre-Install Requirements and Prerequisites</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Downloading">2.1.2. Downloading</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Configuring">2.1.3. Configuring (and Setting JBOSS_HOME)</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Installing">2.1.4. Installing</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Running">2.1.5. Running</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Stopping">2.1.6. Stopping</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Uninstalling">2.1.7. Uninstalling</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Building_From_Source">2.1.8. Building from Source Project</a></span></dt><dt><span class="section"><a href="#itsps-binary-SIP_Presence_Service-Binary_Releases_Daily_Snapshots">2.1.9. Binary Releases Daily Snapshots</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="itsps-binary-SIP_Presence_Service-Installing_Configuring_and_Running"/>2.1. Mobicents SIP Presence Service: Installing, Configuring and Running</h2></div></div></div><p>There are multiple binary distributions of the <span class="application"><strong>Mobicents SIP Presence Service</strong></span>.</p><div class="variablelist"><a id="itsps-Description_of_the_Different_SIP_Presence_Service_Distributions"/><p class="title"><b>Description of the different Mobicents SIP Presence Service Distributions</b></p><dl><dt><span class="term">The <span class="application"><strong>Integrated SIP Presence Service</strong></span> binary distribution <span class="emphasis"><em>with Mobicents JAIN SLEE</em></span>
				</span></dt><dd><p>These installation instructions detail the installation, running and configuring of the <span class="emphasis"><em>Integrated</em></span> binary <span class="application"><strong>Mobicents SIP Presence Service</strong></span> distribution. This distribution includes the <span class="application"><strong>XDM</strong></span> and <span class="application"><strong>SIP Presence Servers</strong></span>, the servers are pre-installed in a version of the <span class="application"><strong>Mobicents JAIN SLEE</strong></span>, and the Mobicents JAIN SLEE SIP11 and HTTP Servlet Resource Adaptors. Examples of JAIN SLEE applications interacting with the <span class="application"><strong> Mobicents Integrated SIP Presence Service</strong></span> are also included and come pre-installed.</p></dd><dt><span class="term">The stand-alone <span class="application"><strong>Mobicents XDM Server</strong></span> binary distribution <span class="emphasis"><em> with Mobicents JAIN SLEE</em></span>
				</span></dt><dd><p>Users who wish to deploy the <span class="application"><strong>Mobicents XML Document Server</strong></span> on a different host or who do not require the <span class="application"><strong>Mobicents Presence Server</strong></span> should install the stand-alone <span class="application"><strong>Mobicents XDM Server</strong></span> binary distribution. The following installation, running and configuring instructions provide parallel instructions specific to the <span class="application"><strong>Mobicents XDM Server</strong></span>.</p></dd><dt><span class="term">The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> binary distribution <span class="emphasis"><em>without</em></span> Mobicents JAIN SLEE</span></dt><dd><p>Users who have already installed and set up a separate <span class="application"><strong>Mobicents JAIN SLEE</strong></span> installation may want to install one or more servers of the <span class="application"><strong>Mobicents SIP Presence Service</strong></span>.</p></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-PreInstall_Requirements_and_Prerequisites"/>2.1.1. Pre-Install Requirements and Prerequisites</h3></div></div></div><p>You should ensure that a few requirements have been met before continuing with the install.</p><div class="variablelist"><a id="itsps-binary-SIP_Presence_Service-Hardware_Requirements"/><p class="title"><b>Hardware Requirements</b></p><dl><dt><span class="term">Anything Java Itself Will Run On</span></dt><dd><p>The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> is an 100% Java application. <span class="application"><strong>Mobicents SIP Presence Service</strong></span> will run on the same hardware that the <span class="application"><strong>Mobicents JAIN SLEE</strong></span> runs on.</p></dd></dl></div><div class="variablelist"><a id="itsps-binary-SIP_Presence_Service-Software_Prerequisites"/><p class="title"><b>Software Prerequisites</b></p><dl><dt><span class="term">JDK 6</span></dt><dd><p>A working installation of the Java Development Kit (<acronym class="acronym">JDK</acronym>) version 6 or higher is required in order to run the <span class="application"><strong>Mobicents SIP Presence Service</strong></span>.</p></dd><dt><span class="term">Apache Ant 1.6 or later</span></dt><dd><p>A working installation of the Apache Ant 1.6 or later is required in order to install the <span class="application"><strong>Mobicents SIP Presence Service</strong></span> release without <span class="application"><strong>Mobicents JAIN SLEE</strong></span>.</p></dd><dt><span class="term">Mobicents JAIN SLEE 2.x</span></dt><dd><p>The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> is a set of JAIN SLEE and JEE components built on top of <span class="application"><strong>Mobicents JAIN SLEE</strong></span> container.</p></dd><dt><span class="term">JBOSS_HOME Environment Variable</span></dt><dd><p>The environment variable JBOSS_HOME, if set, must be pointing to the <span class="application"><strong>JBoss AS</strong></span> within <span class="application"><strong>Mobicents JAIN SLEE</strong></span>.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Downloading"/>2.1.2. Downloading</h3></div></div></div><p>You can download the latest version of the <span class="application"><strong>Mobicents SIP Presence Service</strong></span> distribution you need from the Mobicents <code class="literal">Downloads</code> page at <a class="ulink" href="https://sourceforge.net/projects/mobicents/files/Mobicents%20SIP%20Presence%20Service/">https://sourceforge.net/projects/mobicents/files/Mobicents%20SIP%20Presence%20Service/</a>. The latest releases are nearer the top.</p><p>If you are unsure which distribution zip file to download, refer to <a class="xref" href="#itsps-Description_of_the_Different_SIP_Presence_Service_Distributions" title="Description of the different Mobicents SIP Presence Service Distributions">Description of the different Mobicents SIP Presence Service Distributions</a>, and then to the following list of release binaries.</p><div class="variablelist"><a id="itsps-SIP_Presence_Service_Binary_Distribution_Zip_Files"/><p class="title"><b>Mobicents SIP Presence Service Binary Distribution Zip Files</b></p><dl><dt><span class="term">mobicents-sip-presence-integrated-1.0.0.FINAL.zip</span></dt><dd><p>Download this zip file to obtain the <span class="application"><strong>Mobicents Integrated SIP Presence Service</strong></span> binary distribution, which includes the <span class="application"><strong>Mobicents SIP Presence Server</strong></span>, the <span class="application"><strong>Mobicents XDM Server</strong></span>, and the <span class="application"><strong>JBoss Application Server</strong></span> with <span class="application"><strong>Mobicents JAIN SLEE</strong></span>, well as all required JAIN SLEE Resource Adaptors.</p></dd><dt><span class="term">mobicents-sip-presence-xdms-1.0.0.FINAL.zip</span></dt><dd><p>Download this zip file to obtain the <span class="application"><strong>Mobicents XDM Server</strong></span> binary distribution, which bundles the <span class="application"><strong>JBoss Application Server</strong></span> with <span class="application"><strong>Mobicents JAIN SLEE</strong></span>.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Configuring"/>2.1.3. Configuring (and Setting JBOSS_HOME)</h3></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="d0e763"/>2.1.3.1. Setting the JBOSS_HOME Environment Variable</h4></div></div></div><p>
		The <span class="application"><strong>Mobicents Platform</strong></span> (<span class="application"><strong>Mobicents</strong></span>) is built on top of the <span class="application"><strong>JBoss Application Server</strong></span> (<span class="application"><strong>JBoss AS</strong></span>). You do not need to set the <code class="envar">JBOSS_HOME</code> environment variable to run any of the <span class="application"><strong>Mobicents Platform</strong></span> servers <span class="emphasis"><em>unless</em></span> <code class="envar">JBOSS_HOME</code> is <span class="emphasis"><em>already</em></span> set.
	</p><p>The best way to know for sure whether <code class="envar">JBOSS_HOME</code> was set previously or not is to perform a simple check which may save you time and frustration.</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Checking to See If JBOSS_HOME is Set on Unix</h5><p class="formalpara">At the command line, <code class="command">echo</code>
			<strong class="userinput"><code>$JBOSS_HOME</code></strong> to see if it is currently defined in your environment:</p><pre class="screen">~]$ echo $JBOSS_HOME</pre><p>The <span class="application"><strong>Mobicents Platform</strong></span> and most Mobicents servers are built on top of the <span class="application"><strong>JBoss Application Server</strong></span> (<span class="application"><strong>JBoss AS</strong></span>). When the <span class="application"><strong>Mobicents Platform</strong></span> or Mobicents servers are built <span class="emphasis"><em>from source</em></span>, then <code class="envar">JBOSS_HOME</code> <span class="emphasis"><em>must</em></span> be set, because the Mobicents files are installed into (or “<span class="quote">over top of</span>” if you prefer) a clean <span class="application"><strong>JBoss AS</strong></span> installation, and the build process assumes that the location pointed to by the <code class="envar">JBOSS_HOME</code> environment variable at the time of building is the <span class="application"><strong>JBoss AS</strong></span> installation into which you want it to install the Mobicents files.
	</p><p>This guide does not detail building the <span class="application"><strong>Mobicents Platform</strong></span> or any Mobicents servers from source. It is nevertheless useful to understand the role played by <span class="application"><strong>JBoss AS</strong></span> and <code class="envar">JBOSS_HOME</code> in the Mobicents ecosystem.</p><p>
		The immediately-following section considers whether you need to set <code class="envar">JBOSS_HOME</code> at all and, if so, when. The subsequent sections detail how to set <code class="envar">JBOSS_HOME</code> on Unix and Windows
	</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>
			Even if you fall into the category below of <span class="emphasis"><em>not needing</em></span> to set <code class="envar">JBOSS_HOME</code>, you may want to for various reasons anyway. Also, even if you are instructed that you do <span class="emphasis"><em>not need</em></span> to set <code class="envar">JBOSS_HOME</code>, it is good practice nonetheless to check and make sure that <code class="envar">JBOSS_HOME</code> actually <span class="emphasis"><em>isn't</em></span> set or defined on your system for some reason. This can save you both time and frustration.
		</p></div><h5><a id="d0e889"/>You <span class="emphasis"><em>DO NOT NEED</em></span> to set <code class="envar">JBOSS_HOME</code> if...</h5><div class="itemizedlist"><ul><li><p>
				...you have installed the <span class="application"><strong>Mobicents Platform</strong></span> binary distribution.
			</p></li><li><p>
				...you have installed a Mobicents server binary distribution <span class="emphasis"><em>which bundles <span class="application"><strong>JBoss AS</strong></span>.</em></span>
			</p></li></ul></div><h5><a id="d0e913"/>You <span class="emphasis"><em>MUST</em></span> set <code class="envar">JBOSS_HOME</code> if...</h5><div class="itemizedlist"><ul><li><p>
				...you are installing the <span class="application"><strong>Mobicents Platform</strong></span> or any of the Mobicents servers <span class="emphasis"><em>from source</em></span>.
			</p></li><li><p>
				...you are installing the <span class="application"><strong>Mobicents Platform</strong></span> binary distribution, or one of the Mobicents server binary distributions, which <span class="emphasis"><em>do not</em></span> bundle <span class="application"><strong>JBoss AS</strong></span>.
			</p></li></ul></div><p>
		Naturally, if you installed the <span class="application"><strong>Mobicents Platform</strong></span> or one of the Mobicents server binary releases which <span class="emphasis"><em>do not</em></span> bundle <span class="application"><strong>JBoss AS</strong></span>, yet requires it to run, then you should <a class="ulink" href="http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Installation_Guide/4/html/index.html">install <span class="application"><strong>JBoss AS</strong></span>
		</a> before setting <code class="envar">JBOSS_HOME</code> or proceeding with anything else.
	</p><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the JBOSS_HOME Environment Variable on Unix</h5><p class="formalpara">
			The <code class="envar">JBOSS_HOME</code> environment variable must point to the directory which contains all of the files for the <span><span class="application"><strong>Mobicents Platform</strong></span> or individual Mobicents server</span> that you installed. As another hint, this topmost directory contains a <code class="filename">bin</code> subdirectory.
		</p><p>
		Setting <code class="envar">JBOSS_HOME</code> in your personal <code class="filename">~/.bashrc</code> startup script carries the advantage of retaining effect over reboots. Each time you log in, the environment variable is sure to be set for you, as a user. On Unix, it is possible to set <code class="envar">JBOSS_HOME</code> as a system-wide environment variable, by defining it in <code class="filename">/etc/bashrc</code>, but this method is neither recommended nor detailed in these instructions.
	</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e993"/><p class="title"><b>Procedure 2.1. To Set JBOSS_HOME on Unix...</b></p><ol class="1"><li><p>
				Open the <code class="filename">~/.bashrc</code> startup script, which is a hidden file in your home directory, in a text editor, and insert the following line on its own line while substituting for the actual install location on your system:
			</p><pre class="screen">export JBOSS_HOME="/home/&lt;username&gt;/&lt;path&gt;/&lt;to&gt;/&lt;install_directory&gt;"</pre></li><li><p>
				Save and close the <code class="filename">.bashrc</code> startup script.
			</p></li><li><p>
				You should <code class="command">source</code> the <code class="filename">.bashrc</code> script to force your change to take effect, so that <code class="envar">JBOSS_HOME</code> becomes set for the current session<sup>[<a id="d0e1023" href="#ftn.d0e1023" class="footnote">1</a>]</sup>.
			</p><pre class="screen">~]$ source ~/.bashrc</pre></li><li><p>
				Finally, ensure that <code class="envar">JBOSS_HOME</code> is set in the current session, and actually points to the correct location:
			</p><div class="note"><h2>Note</h2><p>
					The command line usage below is based upon a binary installation of the <span class="application"><strong>Mobicents Platform</strong></span>. In this sample output, <code class="envar">JBOSS_HOME</code> has been set correctly to the <em class="replaceable"><code>topmost_directory</code></em> of the <span class="application"><strong>Mobicents</strong></span> installation. Note that if you are installing one of the standalone <span class="application"><strong>Mobicents</strong></span> servers (with <span class="application"><strong>JBoss AS</strong></span> bundled!), then <code class="envar">JBOSS_HOME</code> would point to the <em class="replaceable"><code>topmost_directory</code></em> of your server installation.
				</p></div><pre class="screen">~]$ echo $JBOSS_HOME
/home/silas/&lt;path&gt;/&lt;to&gt;/&lt;install_directory&gt;</pre></li></ol></div><h5 xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="formalpara">Setting the JBOSS_HOME Environment Variable on Windows</h5><p class="formalpara">
			The <code class="envar">JBOSS_HOME</code> environment variable must point to the directory which contains all of the files for the <span>Mobicents Platform or individual Mobicents server</span> that you installed. As another hint, this topmost directory contains a <code class="filename">bin</code> subdirectory.
		</p><p>
		For information on how to set environment variables in recent versions of Windows, refer to <a class="ulink" href="http://support.microsoft.com/kb/931715">http://support.microsoft.com/kb/931715</a>.
	</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Installing"/>2.1.4. Installing</h3></div></div></div><p>Once the requirements and prerequisites have been met, and you have downloaded the correct zip file for the binary distribution you need, you are ready to install, please follow the instructions below.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1101"/><p class="title"><b>Procedure 2.2. Installing a Mobicents SIP Presence Service Binary Distribution bundled <span class="emphasis"><em>with</em></span> <span class="application"><strong>Mobicents JAIN SLEE</strong></span></b></p><ol class="1"><li><p>Unzip the release file</p></li><li><p>Ensure that the environment variable JBOSS_HOME is either not set, or pointing to the <code class="filename">&lt;install_directory&gt;</code> directory extracted from the release file.</p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1118"/><p class="title"><b>Procedure 2.3. Installing a Mobicents SIP Presence Service Binary Distribution <span class="emphasis"><em>without</em></span> Mobicents JAIN SLEE</b></p><ol class="1"><li><p>Unzip the release file</p></li><li><p>Ensure that the environment variable JBOSS_HOME is set and pointing to the JBoss AS with the <span class="application"><strong>Mobicents JAIN SLEE</strong></span>, where <span class="application"><strong>Mobicents SIP Presence Service</strong></span> components should be installed.</p></li><li><p>Invoke the correct Apache Ant target in build.xml script to install:</p><h4><a id="d0e1139"/>Install the <span class="application"><strong>Integrated SIP Presence Service</strong></span>:</h4><pre class="screen">~]$ ant integrated-deploy</pre><h4><a id="d0e1146"/>Install the stand-alone <span class="application"><strong> XDM Server</strong></span>:</h4><pre class="screen">~]$ ant xdms-deploy</pre></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Running"/>2.1.5. Running</h3></div></div></div><p>Once installed, you can run server(s) by executing the run.sh (Unix) or run.bat (Microsoft Windows) startup scripts in the <code class="filename">&lt;install_directory&gt;/bin</code> directory (on Unix or Windows).</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>By default the server(s) start and bind to 127.0.0.1 IP, to use a different hostname or IP use the -b HOST parameter when executing the startup script (e.g. run.sh -b 172.31.1.1).</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Stopping"/>2.1.6. Stopping</h3></div></div></div><p>You can shut down the server(s) you can run server(s) by executing the shutdown.sh (Unix) or shutdown.bat (Microsoft Windows) scripts in the <code class="filename">&lt;install_directory&gt;/bin</code> directory (on Unix or Windows). Note that if you properly stop the server, you will see the following three lines as the last output in the Unix terminal or Command Prompt:</p><pre class="programlisting">[Server] Shutdown complete
Shutdown complete
Halting VM</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Uninstalling"/>2.1.7. Uninstalling</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1177"/><p class="title"><b>Procedure 2.4. Uninstalling a Mobicents SIP Presence Service Binary Distribution bundled <span class="emphasis"><em>with</em></span> <span class="application"><strong>Mobicents JAIN SLEE</strong></span></b></p><ul><li><p>To uninstall the <span class="application"><strong>SIP Presence Service</strong></span> or <span class="application"><strong>XDM Server</strong></span>, simply delete the directory you decompressed the binary distribution archive into.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e1194"/><p class="title"><b>Procedure 2.5. Uninstalling a Mobicents SIP Presence Service Binary Distribution <span class="emphasis"><em>without</em></span> Mobicents JAIN SLEE</b></p><ul><li><p>Invoke the correct Apache Ant target in build.xml script to uninstall:</p><h4><a id="d0e1203"/>Uninstall the Integrated <span class="application"><strong>SIP Presence Service</strong></span>:</h4><pre class="screen">~]$ ant integrated-undeploy</pre><h4><a id="d0e1210"/>Uninstall the stand-alone <span class="application"><strong>XDM Server</strong></span>:</h4><pre class="screen">~]$ ant xdms-undeploy</pre></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Building_From_Source"/>2.1.8. Building from Source Project</h3></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>The source building process requires access to the Internet. It also requires an <span class="application"><strong>SVN Client</strong></span> (to sources checkout) and <span class="application"><strong>Apache Maven2 2.0.9+</strong></span> (for the building process) installed.</p></div><p>The source project can be downloaded using SVN, the checkout URL is <code class="uri">http://mobicents.googlecode.com/svn/tags/servers/sip-presence/mobicents-sip-presence-service-1.0.0.FINAL</code> </p><p><span class="application"><strong>Mobicents SIP Presence Service</strong></span> configurations can be done through the root <code class="filename">pom.xml</code>.</p><p>To build the binaries from source, enter the release directory inside the directory used to checkout the source project and:</p><pre class="screen">~]$ ant</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="itsps-binary-SIP_Presence_Service-Binary_Releases_Daily_Snapshots"/>2.1.9. Binary Releases Daily Snapshots</h3></div></div></div><p>Everyday a binary release snapshot is built using current sources in development trunk, those are accessible from <code class="uri">http://hudson.jboss.org/hudson/view/Mobicents/job/MobicentsSipPresenceRelease/</code></p></div></div><div xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="footnotes"><br/><hr/><div xmlns="http://www.w3.org/1999/xhtml" class="footnote"><p><sup>[<a id="ftn.d0e1023" href="#d0e1023" class="para">1</a>] </sup>
					Note that any other terminals which were opened prior to your having altered <code class="filename">.bashrc</code> will need to <code class="command">source</code>
						<code class="filename">~/.bashrc</code> as well should they require access to <code class="envar">JBOSS_HOME</code>.
				</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="xdms-XML_Document_Management_Server"/>Chapter 3. Mobicents XML Document Management Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server">3.1. Configuring the XDM Server</a></span></dt><dd><dl><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_XCAP_ROOT">3.1.1. Configuring the XDM Server XCAP root</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_XCAP_Interface">3.1.2. Other configurations in the XDM Server XCAP Interface</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_SIP_Interface">3.1.3. Configuring the XDM Server XCAP Diff SIP Subscription Interface</a></span></dt><dt><span class="section"><a href="#xdms-Configuring_the_XDM_Server_Users">3.1.4. XDM Server User Profile Provisioning</a></span></dt><dt><span class="section"><a href="#xdm-xcap_app_usages">3.1.5. XCAP Application Usages</a></span></dt></dl></dd></dl></div><p>The <span class="application"><strong>Mobicents XML Document Management Server</strong></span> (XDMS) is part of the <span class="application"><strong>Mobicents SIP Presence Service</strong></span>. It is the first free and open source implementation of an <span class="application"><strong>XML Document Management Server</strong></span> as defined in the Open Mobile Alliance (OMA) XML Document Management v1.1 specification. This functional element of next-generation IP communication networks is responsible for handling the management of user XML documents stored on the network side, such as presence authorization rules, contact and group lists (also known as resource lists), static presence information, and much more.</p><p>The <span class="application"><strong>XDM Server</strong></span> comprises the following functional elements:</p><div class="variablelist"><a id="xdms-Functional_Elements_of_the_XDM_Server"/><p class="title"><b>Functional Elements of the XDM Server</b></p><dl><dt><span class="term">Data Source</span></dt><dd><p>The XDM Server data source is where all user XML documents are stored. Information related to the server itself is also stored in this element along with the user's provisioned data.</p><p>The data source also handles subscriptions to updates on specific documents, or complete XCAP application usages.</p></dd><dt><span class="term">Aggregation Proxy</span></dt><dd><p>The aggregation proxy is responsible for handling an XDM client's XCAP requests.</p></dd><dt><span class="term">Authentication Proxy</span></dt><dd><p>The authentication proxy is responsible for authentication of the user related with each XCAP request handled.</p></dd><dt><span class="term">Request Processor</span></dt><dd><p>This element includes the XCAP Server logic to process an XCAP request and return a proper response, including authorization for the authenticated user.</p></dd><dt><span class="term">XDM Event Subscription Control</span></dt><dd><p>This element, using the SIP protocol, is responsible for handling subscriptions to documents managed by the XDM. Its functions include the authentication and authorization of a subscription, attachment to update events on specific documents or collections, and the sending of notifications when documents change. This interface is fully compatible with the XCAP DIFF event package, defined by IETF RFC 5875.</p></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="xdms-Configuring_the_XDM_Server"/>3.1. Configuring the XDM Server</h2></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="xdms-Configuring_the_XDM_Server_XCAP_ROOT"/>3.1.1. Configuring the XDM Server XCAP root</h3></div></div></div><p>The Mobicents XDM Server comes pre-configured for an XCAP root of http://&lt;hostname&gt;:8080/mobicents, hostname being the host/<acronym class="acronym">IP</acronym> used to start the server (127.0.0.1 by default). It is possible to change the host, the port and the last path segment:</p><div class="itemizedlist"><ul><li><p>Rename <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents.war</code> to the desired last path segment in the XCAP root (e.g. rename to xcap-root.war for an XCAP root of http://&lt;hostname&gt;:8080/xcap-root). The &lt;server_profile&gt; is the server configuration/profile used in the underlying <span class="application"><strong>JBoss AS</strong></span>, by default it is <span class="emphasis"><em>default</em></span></p></li><li><p>Edit <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/http-servlet-ra-DU-*.jar/META-INF/deploy-config.xml</code>. Uncomment and set custom servlet name again to the desired last path segment in the XCAP root.</p></li><li><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-xdms/3-beans/configuration/xdms/META-INF/jboss-beans.xml</code>. Note that the xcapRoot has a leading and trailing /. Also note that for the <span class="application"><strong>Integrated Server</strong></span> the path segment mobicents-xdms is mobicents-sip-presence.</p><p>This configuration part can also be done through JMX, using the MBean named <span class="emphasis"><em>org.mobicents.sippresence:name=XDMServerConfiguration</em></span>. The configuration changes through JMX are not persistent.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="xdms-Configuring_the_XDM_Server_XCAP_Interface"/>3.1.2. Other configurations in the XDM Server XCAP Interface</h3></div></div></div><p>There are other configurable features related with the XCAP Interface:</p><div class="itemizedlist"><ul><li><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-xdms/3-beans/configuration/xdms/META-INF/jboss-beans.xml</code>. Note that for the <span class="application"><strong>Integrated Server</strong></span> the path segment mobicents-xdms is mobicents-sip-presence.</p><p>This configuration part can also be done through JMX, using the MBean named <span class="emphasis"><em>org.mobicents.sippresence:name=XDMServerConfiguration</em></span>. The configuration changes through JMX are not persistent.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="xdms-Configuring_the_XDM_Server_SIP_Interface"/>3.1.3. Configuring the XDM Server XCAP Diff SIP Subscription Interface</h3></div></div></div><p>The Mobicents XDM Server SIP Interface can be configured regarding several features, such as subscription timers:</p><div class="itemizedlist"><ul><li><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-xdms/3-beans/configuration/sip-event/subscription/META-INF/jboss-beans.xml</code>. Note that for the <span class="application"><strong>Integrated Server</strong></span> the path segment mobicents-xdms is mobicents-sip-presence.</p><p>This configuration part can also be done through JMX, using the MBean named <span class="emphasis"><em>org.mobicents.sippresence:name=SipEventSubscriptionControl</em></span>. The configuratian changes through JMX are not persistent.</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="xdms-Configuring_the_XDM_Server_Users"/>3.1.4. XDM Server User Profile Provisioning</h3></div></div></div><p>The XCAP interface is public, used by users to manage their information such as buddy lists, presence authorization rules, etc, and needs to enforce user authentication. To do this, the server relies on the User Profile Enabler managed data, such as the users passwords, and this information must be provisioned. This can be done in two ways, both requiring the server to be running:</p><div class="variablelist"><dl><dt><span class="term">User Provisioning through an JMX Client</span></dt><dd><p>Users can be added/removed through the <span class="emphasis"><em>org.mobicents.sippresence:name=UserProfileControl</em></span> MBean. </p></dd><dt><span class="term">User Provisioning through the <span class="application"><strong>JBoss AS</strong></span> default datasource.</span></dt><dd><p>Users can be added/removed through adding/removing rows to the <span class="emphasis"><em>MOBICENTS_SLEE_ENABLER_USERPROFILES</em></span> table.</p></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="xdms-Asserted_User_IDs"/>3.1.4.1. User Asserted IDs</h4></div></div></div><p>The XDM Server allows the usage of asserted user IDs, through the <code class="literal">X-3GPP-Asserted-Identity</code> or <code class="literal">X-XCAP-Asserted-Identity</code> header in the XCAP request. If the XDM Server is directly exposed to the public, this feature should be disabled, through the configuration of the XCAP Interface.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="xdms-Local_XCAP_Requests"/>3.1.4.2. Local XCAP Requests</h4></div></div></div><p>By default, the local (same host) XCAP requests will go around user authentication. This can also be disabled through configuration of the XCAP interface.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="xdms-Xcap_Diff_Super_Users"/>3.1.4.3. Xcap Diff Super Users</h4></div></div></div><p>It is possible to define a set of super users, through the configuration of the XCAP interface, which are authorized to subscribe any document or collection. Any other user may only subscribe documents in its own user directory, for each XCAP app usage deployed. By default there are no super users configured.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="xdm-xcap_app_usages"/>3.1.5. XCAP Application Usages</h3></div></div></div><p>What is an XCAP Application Usage?</p><p>"Each XCAP resource on a server is associated with an application.  In order for an application to use those resources, application specific conventions must be specified.  Those conventions include the XML schema that defines the structure and constraints of the data, well-known URIs to bootstrap access to the data, and so on.  All of those application specific conventions are defined by the application usage." RFC 4825</p><p>Each XCAP Application Usage defines:</p><div class="variablelist"><dl><dt><span class="term">Application Unique ID</span></dt><dd><p>The AUID used in XCAP URIs to point to a specific App Usage, e.g. <code class="literal">resource-lists</code> in http://xdms.mobicents.org:8080/xcap-root/resource-lists/users/sip:user@mobicents.org/index</p></dd><dt><span class="term">Default Document Namespace</span></dt><dd><p>Defines the namespace of elements/attributes without prefix in XCAP URIs, usually it matches the default namespace of the XML Schema for documents of the App Usage,e.g. in http://xdms.mobicents.org/xcap-root/pres-rules/users/sip:eduardo@mobicents.org/index/~~/watcherinfo/watcher-list/watcher[@id="8ajksjda7s"],  selection is made on <code class="literal">watcher</code> elements with the pres-rules default document namespace.</p></dd><dt><span class="term">MIME Type</span></dt><dd><p>MIME Type used when exchanging XML content.</p></dd><dt><span class="term">XML Schema and Data Constraints</span></dt><dd><p>The XML Schema to validate documents; Data constraints, which are impossible to validate with XML Schema, e.g. one element value must be a ISO country name (2 char) that belongs to Europe.</p></dd><dt><span class="term">Data Semantics</span></dt><dd><p>Semantic definition on documents content, used by applications filling data, not validated by servers.</p></dd><dt><span class="term">Naming Conventions</span></dt><dd><p>What is the document name for each user? Are there global documents under a specific name? XCAP Clients usually forget to follow these!</p></dd><dt><span class="term">Resource Interdependencies</span></dt><dd><p>One request may update other documents as well, e.g. global/index document in rls-services, a composition of all users/*/index <code class="literal">service</code> elements.</p></dd><dt><span class="term">Authorization Policies</span></dt><dd><p>What each user can read or write?</p></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="xdm-xcap-app-usages_deployed"/>3.1.5.1. XCAP Application Usages Deployed</h4></div></div></div><p>The <span class="application"><strong>Mobicents XDM Server</strong></span> includes the following XCAP application usages:</p><div class="itemizedlist"><ul><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc5025">IETF Presence Rules (RFC 5025)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/Presence_simple_v1_1.aspx">OMA Presence Rules (OMA Presence Simple v1.1)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/xdm_v2_0.aspx">OMA Presence Content (OMA XDM v2.0)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4827">IETF Presence Document Content Manipulation (IETF RFC 4827)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4826">IETF Resource Lists</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/xdm_v1_1.aspx">OMA Group Usage List (OMA XDM v1.1)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4826">IETF RLS Services (RFC 4826)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/xdm_v2_0.aspx">OMA User Profile (OMA XDM v2.0)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/xdm_v2_0.aspx">OMA Locked User Profile (OMA XDM v2.0)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4825">IETF XCAP-CAPS (RFC 4825)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org/Technical/release_program/xdm_v1_1.aspx">OMA XCAP Directory (OMA XDM v1.1)</a>
			</p></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="xdm-developing_xcap_app_usages"/>3.1.5.2. Developing XCAP Application Usages</h4></div></div></div><p>The <span class="application"><strong>Mobicents XDM Server</strong></span> XCAP Application Usages are implemented with a few simple Java classes and some meta data, it is very easy to develop additional ones.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="xdm-developing_xcap_app_usages-app_usage_class"/>3.1.5.2.1. The AppUsage Class</h5></div></div></div><p>Each Application Usage is represented by a Java class extending the abstract <code class="literal">org.mobicents.xdm.server.appusage.AppUsage</code> class:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">xcap</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">appusage</span><span class="java_separator">.</span><span class="java_plain">presrules</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsage</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;ID&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;pres-rules&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;DEFAULT_DOC_NAMESPACE&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;urn:ietf:params:xml:ns:pres-rules&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;MIMETYPE&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">&quot;application/auth-policy+xml&quot;</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_keyword">static</span><span class="java_plain">&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;AUTH_ONLY_DOCUMENT_NAME&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;index</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsage</span><span class="java_separator">(</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;schemaValidator</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">super</span><span class="java_separator">(</span><span class="java_plain">ID</span><span class="java_separator">,</span><span class="java_plain">DEFAULT_DOC_NAMESPACE</span><span class="java_separator">,</span><span class="java_plain">MIMETYPE</span><span class="java_separator">,</span><span class="java_plain">schemaValidator</span><span class="java_separator">,</span><span class="java_plain">AUTH_ONLY_DOCUMENT_NAME</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>Methods for schema validation, data constraints and resource interdependencies can be overriden:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;validateSchema</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkConstraintsOnPut</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;checkConstraintsOnDelete</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processResourceInterdependenciesOnPutDocument</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;processResourceInterdependenciesOnDeleteElement</span><span class="java_separator">(...);</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>RLSServicesAppUsage and ResourceListsAppUsage are good examples on how to implement those methods.</p></div><p>Multiple constructors exposed to provide your App Usage XML Schemas Validators and/or Authorization Policies:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;auid</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;defaultDocumentNamespace</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;mimetype</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;schemaValidator</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;authorizedUserDocumentName</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;auid</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;defaultDocumentNamespace</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;mimetype</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;schemaValidator</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">AuthorizationPolicy</span><span class="java_plain">&nbsp;authorizationPolicy</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;auid</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;defaultDocumentNamespace</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;mimetype</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;schemaValidator</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;uniquenessSchemaValidator</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;authorizedUserDocumentName</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;auid</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;defaultDocumentNamespace</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;mimetype</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;schemaValidator</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Validator</span><span class="java_plain">&nbsp;uniquenessSchemaValidator</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">AuthorizationPolicy</span><span class="java_plain">&nbsp;authorizationPolicy</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Default Authorization Policy if custom is not provided, an user can read/write his/her own documents, with the specified document name.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="xdm-developing_xcap_app_usages-app_usage_factory_class"/>3.1.5.2.2. The AppUsageFactory Class</h5></div></div></div><p>An implementation of an object factory is required, which should extend class named <code class="literal">org.mobicents.xdm.server.appusage.AppUsageFactory</code>:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">xcap</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">appusage</span><span class="java_separator">.</span><span class="java_plain">presrules</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsageFactory</span><span class="java_plain">&nbsp;</span><span class="java_keyword">implements</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsageFactory</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">private</span><span class="java_plain">&nbsp;</span><span class="java_type">Schema</span><span class="java_plain">&nbsp;schema&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsageFactory</span><span class="java_separator">(</span><span class="java_type">Schema</span><span class="java_plain">&nbsp;schema</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">this</span><span class="java_separator">.</span><span class="java_plain">schema&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;schema</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsage</span><span class="java_plain">&nbsp;getAppUsageInstance</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsage</span><span class="java_separator">(</span><span class="java_plain">schema</span><span class="java_separator">.</span><span class="java_plain">newValidator</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getAppUsageId</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsage</span><span class="java_separator">.</span><span class="java_plain">ID</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsageDataSourceInterceptor</span><span class="java_plain">&nbsp;getDataSourceInterceptor</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>The factory is used to maintain a cache/pool of your app usage objects, since XML Schema Validator are expensive objects to create.</p><p>The factory can also provide a DataSource Interceptor, which will be used to generate a document on request (for instance the oma-xcap-directory generates the user document for each request).</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="xdm-developing_xcap_app_usages-app_usage_deployer_class"/>3.1.5.2.3. The AppUsageDeployer Class And XML Descriptor</h5></div></div></div><p>A deployer to load/unload the App Usage into the XDM Server, it should extend class named <code class="literal">org.mobicents.xdm.server.appusage.AppUsageDeployer</code>:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">xcap</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">appusage</span><span class="java_separator">.</span><span class="java_plain">presrules</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_operator">//</span><span class="java_plain">&nbsp;</span><span class="java_separator">...</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">class</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsageDeployer</span><span class="java_plain">&nbsp;</span><span class="java_keyword">extends</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsageDeployer</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">AppUsageFactory</span><span class="java_plain">&nbsp;createAppUsageFactory</span><span class="java_separator">(</span><span class="java_type">Schema</span><span class="java_plain">&nbsp;schema</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsageFactory</span><span class="java_separator">(</span><span class="java_plain">schema</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;@</span><span class="java_type">Override</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;getSchemaRootNamespace</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_type">PresRulesAppUsage</span><span class="java_separator">.</span><span class="java_plain">DEFAULT_DOC_NAMESPACE</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><p>Multiple XML schema files may be combined, starting point is the namespace returned by <code class="literal">getSchemaRootNamepsace()</code>, which not always is the same as the app usage's default doc namespace.</p><p>The deployer is actually a JBoss Microcontainer Bean, and a <code class="filename">jboss-beans.xml</code> file is needed in the META-INF directory of the app usage jar:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_processing_instruction">&lt;?xml&nbsp;version=&quot;1.0&quot;&nbsp;encoding=&quot;UTF-8&quot;?&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">deployment</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">xmlns:xsi</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">xmlns</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;urn:jboss:bean-deployer:2.0&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;Registers&nbsp;the&nbsp;APP&nbsp;USAGE&nbsp;DEPLOYER&nbsp;AS&nbsp;JBOSS&nbsp;MICROCONTAINER&nbsp;BEAN&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Mobicents.XDMS.AppUsage.Deployer.PresRules&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.xcap.server.slee.appusage.presrules.PresRulesAppUsageDeployer&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_comment">&lt;!--&nbsp;this&nbsp;app&nbsp;usage&nbsp;depends&nbsp;on&nbsp;app&nbsp;usage&nbsp;management&nbsp;only&nbsp;--&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">depends</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">Mobicents.XDMS.AppUsageManagement</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">depends</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">deployment</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>A unique bean “name” is need, and of course the “class” name of the Deployer, nothing else needs to be changed.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="xdm-developing_xcap_app_usages-packaging_and_deploy"/>3.1.5.2.4. Packaging and Deploying the XCAP Application Usage</h5></div></div></div><p>The Application Usage classes and metadata should be packed in a jar, with a structure similar to:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;example-appusage.jar</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|-META-INF</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|---jboss-beans.xml&nbsp;(jboss&nbsp;mc&nbsp;bean&nbsp;descriptor)</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|-org</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|---mobicents</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------xdm</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|---------server&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------------appusage</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|---------------example</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------------------ExampleAppUsage&nbsp;(app&nbsp;usage&nbsp;class)</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------------------ExampleAppUsageFactory&nbsp;(factory&nbsp;class)</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------------------ExampleAppUsageDeployer&nbsp;(deployer&nbsp;class)</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;|------------------ExampleAuthorizationPolicy&nbsp;(optional&nbsp;auth&nbsp;policy&nbsp;class)&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>To deploy simply drop the jar in <code class="filename">$JBOSS_HOME/server/default/deploy/mobicents-xdms(or mobicents-sip-presence)/3.beans/appusages</code>. To undeploy simply delete the jar.</p><p>What about the XSD file(s)? Simply copy to the <code class="filename">xsd</code> directory inside the <code class="filename">appusages</code> directory, a few limitations on multiple XSD files combination:</p><div class="variablelist"><dl><dt><span class="term"/></dt><dd><p>References between namespaces on different files must be done through <code class="literal">import</code> element.</p></dd><dt><span class="term"/></dt><dd><p>A namespace can only be defined within a single xsd file.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h5 class="title"><a id="xdm-developing_xcap_app_usages-contributing"/>3.1.5.2.5. Submiting XCAP Application Usages to Mobicents</h5></div></div></div><p>Contribution of additional App Usages are welcome, but a few rules apply:</p><div class="variablelist"><dl><dt><span class="term"/></dt><dd><p>Implements a standard app usage, defined by IETF, OMA or other standard organization.</p></dd><dt><span class="term"/></dt><dd><p>A document is provided defining the app usage. This document may be the one defined by the standard organization.</p></dd><dt><span class="term"/></dt><dd><p>The app usage jar and XSDs are ready to deploy, i.e., if the app usage was already tested and works.</p></dd><dt><span class="term"/></dt><dd><p>Includes JUnit basic tests to validate put/get and delete of a document, similar to the ones included in RLS Services app usage source code, see the ones in the SVN, at <code class="filename">trunk/servers/sip-presence/xdm/server/appusages/rls-services/tests</code>. If the app usage defines data constraints or resource interdependencies then these should be validated by tests too.</p></dd></dl></div></div></div></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sps-SIP_Presence_Server"/>Chapter 4. Mobicents SIP Presence Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#sps-Functional_Architecture_of_the_SIP_Presence_Server">4.1. Functional Architecture of the SIP Presence Server</a></span></dt><dt><span class="section"><a href="#sps-Configuring_The_Sip_Presence_Server">4.2. Configuring The SIP Presence Server</a></span></dt><dd><dl><dt><span class="section"><a href="#sps-Configuring_the_Abstract_SIP_Event_Publication_Interface">4.2.1. Configuring the Abstract SIP Event Publication Interface</a></span></dt><dt><span class="section"><a href="#sps-Configuring_the_Abstract_SIP_Event_Subscription_Interface">4.2.2. Configuring the Abstract SIP Event Subscription Interface</a></span></dt><dt><span class="section"><a href="#sps-Configuring_the_Concrete_SIP_Event_Interfaces">4.2.3. Configuring the Concrete SIP Event Interfaces</a></span></dt></dl></dd><dt><span class="section"><a href="#sps-Content_Accepted_By_The_Sip_Presence_Server">4.3. Content accepted by the SIP Presence Server</a></span></dt></dl></div><p>The <span class="application"><strong>Mobicents SIP Presence Server</strong></span> is a free and open source implementation of a SIP Presence Server, as defined by the Internet Engineering Task Force (IETF), the Open Mobile Alliance (OMA), the 3rd Generation Partnership Project (3GPP) and the European Telecommunications Standards Institute (ETSI).</p><p>The <span class="application"><strong>SIP Presence Server</strong></span> is an entity that accepts, stores and distributes SIP presence information, fully supporting OMA Presence SIMPLE Data Extensions V1.2.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sps-Functional_Architecture_of_the_SIP_Presence_Server"/>4.1. Functional Architecture of the SIP Presence Server</h2></div></div></div><p>The <span class="application"><strong>SIP Presence Server</strong></span> is comprised of the following functional elements:</p><div class="variablelist"><a id="sps-Functional_Elements_of_the_SIP_Presence_Server"/><dl><dt><span class="term">Presence Publication Control</span></dt><dd><p>This functional element manages the publication of presence events, which includes the handling of new publications and the refreshing, modification or removal of already-published information.</p><p>This element is also responsible for composing all of the different publications for the same resource. This is because the presence resource, which is also called a <span class="emphasis"><em>presentity</em></span>, can have multiple publications simultaneously, such as some states published by a user agent or device, and some location data published by a Presence Network Agent (on behalf of the presentity).</p><p>In some presence networks, it may be of interest to allow resources to have a static presence state stored in the XDM Server. In cases like these, Presence Publication Control may need to interface with the <span class="application"><strong>XDM Server</strong></span> to retrieve and subscribe to (learn about changes to) that information, and use it when composing the final presence information document.</p></dd><dt><span class="term">Presence Content Manipulation Control</span></dt><dd><p>This functional element is responsible for subscribing presence content stored in the XDMS, create and manage the related publications in the Presence Publication Contro.</p></dd><dt><span class="term">Presence Subscription Control</span></dt><dd><p>This functional element handles subscriptions to presence events or to the list of subscribers (watchers) for any specific resource. It is responsible for emitting notifications related to those subscriptions.</p><p>Presence authorization rules, which define if a subscription is allowed or rejected and, if allowed, define which transformations to the original presence events are needed, are stored on the <span class="application"><strong>XDM Server</strong></span> by the user. Presence Subscription Control needs to retrieve and subscribe to that information.</p></dd><dt><span class="term">Presence Rules Cache</span></dt><dd><p>This element is responsible for interfacing with the <span class="application"><strong>XDM Server</strong></span> that manages the user's XML presence rules documents. It is responsible for providing the presence rules to the Presence Subscription Control, which are used to authorize the subscriptions it handles.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sps-Configuring_The_Sip_Presence_Server"/>4.2. Configuring The SIP Presence Server</h2></div></div></div><p>Several features of the SIP Presence Server are configurable, through XML files or JMX:</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sps-Configuring_the_Abstract_SIP_Event_Publication_Interface"/>4.2.1. Configuring the Abstract SIP Event Publication Interface</h3></div></div></div><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-sip-presence/3-beans/configuration/sip-event/publication/META-INF/jboss-beans.xml</code>.</p><p>This configuration part can also be done through JMX, using the <span class="emphasis"><em>org.mobicents.sippresence:name=SipEventPublicationControl</em></span> MBean. The configuration changes through JMX are not persistent.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sps-Configuring_the_Abstract_SIP_Event_Subscription_Interface"/>4.2.2. Configuring the Abstract SIP Event Subscription Interface</h3></div></div></div><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-sip-presence/3-beans/configuration/sip-event/subscription/META-INF/jboss-beans.xml</code>.</p><p>This configuration part can also be done through JMX, using the <span class="emphasis"><em>org.mobicents.sippresence:name=SipEventSubscriptionControl</em></span> MBean. The configuration changes through JMX are not persistent.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="sps-Configuring_the_Concrete_SIP_Event_Interfaces"/>4.2.3. Configuring the Concrete SIP Event Interfaces</h3></div></div></div><p>Edit the properties in file <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-sip-presence/3-beans/configuration/sip-presence/META-INF/jboss-beans.xml</code>.</p><p>This configuration part can also be done through JMX, using the <span class="emphasis"><em>org.mobicents.sippresence:name=SipPresenceServerManagement</em></span> MBean. The configuration changes through JMX are not persistent.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="sps-Content_Accepted_By_The_Sip_Presence_Server"/>4.3. Content accepted by the SIP Presence Server</h2></div></div></div><p>The <span class="application"><strong>Mobicents SIP Presence Server</strong></span> accepts the following content type to be published and subscribed by users:</p><div class="itemizedlist"><ul><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc3863">IETF Presence Information Data Format - PIDF (RFC 3863)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4479">A Data Model for Presence (RFC 4479)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4480">IETF Rich Presence Information Data format - RPID (RFC 4480)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4481">IETF Timed Presence Extensions (RFC 4481)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4482">IETF Contact Information in Presence Information Data Format - CIPID (RFC 4482)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc4199">IETF A Presence-based GEOPRIV Location Object Format - GEOPRIV (RFC 4199)</a>
			</p></li><li><p>
				<a class="ulink" href="http://tools.ietf.org/html/rfc5196">IETF SIP UA Capability Extension to Presence Information Data Format (RFC 5196)</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org">OMA Extensions to PIDF and Presence Data Model</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org">OMA PDE - Presence SIMPLE Data Extension 1.0</a>
			</p></li><li><p>
				<a class="ulink" href="http://www.openmobilealliance.org">OMA PDE - Presence SIMPLE Data Extension 1.1</a>
			</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>The content accepted can be easily extended/modified, one just need to add/remove the related XML schema files in the directory <code class="filename">$JBOSS_HOME/server/&lt;server_profile&gt;/deploy/mobicents-sip-presence/3-beans/configuration/sip-presence/xsd</code>.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="rls-Resource_List_Server"/>Chapter 5. Mobicents Resource List Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#rls-Disabling_the_RLS">5.1. Disabling the Resource List Server</a></span></dt></dl></div><p>The <span class="application"><strong>Resource List Server</strong></span> (RLS), is the functional element that handles subscriptions to resource lists. A resource list is defined as a list of any kind of SIP presence entities, be it single presentities or other resource lists.</p><p>The RLS is specified by IETF RFC 5367. It is an XDM Client, that watches all RLS Services documents (each define a list of presence entities) stored in the related XDM Server, and processes SIP presence subscriptions to each RLS Service state (the state for all presence entities deferred by from the service). When handling a subscription to an RLS Service, the RLS creates and manages (possibly virtual) subscriptions to each presence entity on the Presence Server, and notifies the subscriber for entity state change.</p><p>RLS Services are typically used to store the list of entities which the subscriber watches, and the list of entities that are allowed to subscribe its state.</p><p>The Mobicents Resource List Server extends the Presence Server and introduces an additional functional element, the RLS Services Cache. This element is responsible for managing the flat list of entities pointed by each RLS Service, and subscribes changes in referred docs (RLS Services and related Resource Lists). Each time an RLS Service changes the cache notifies the related subscriptions, to ensure the subscriber is always subscribing to the correct list of presence entities.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>The Mobicents RLS is currently limited to RLS Services stored in the integrated XDM Server. These services should not refer other XDM Servers, otherwise the RLS will set the state for the related service as Bad Gateway.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="rls-Disabling_the_RLS"/>5.1. Disabling the Resource List Server</h2></div></div></div><p>It is possible to disable the RLS function from the integrated server. This is achieved by configuring the Presence Server's Subscription Interface. See <a class="xref" href="#sps-Configuring_the_Abstract_SIP_Event_Subscription_Interface" title="4.2.2. Configuring the Abstract SIP Event Subscription Interface">Section 4.2.2, “Configuring the Abstract SIP Event Subscription Interface”</a> for additional information.</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="msps-Client_Applications"/>Chapter 6. Client JAIN SLEE Applications</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#msps-XDM_Client_Enabler">6.1. XDM Client JAIN SLEE Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler">6.2. The Mobicents SIP Event Publication Client Enabler</a></span></dt><dd><dl><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler-integrating">6.2.1. Integrating the Mobicents SIP Event Publication Client Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_publication_client_enabler--using">6.2.2. Using the Mobicents SIP Event Publication Client Enabler</a></span></dt></dl></dd><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler">6.3. The Mobicents SIP Event Subscription Client Enabler</a></span></dt><dd><dl><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler-integrating">6.3.1. Integrating the Mobicents SIP Event Subscription Client Enabler</a></span></dt><dt><span class="section"><a href="#msps-sip_event_subscription_client_enabler-using">6.3.2. Using the Mobicents SIP Event Subscription Client Enabler</a></span></dt></dl></dd><dt><span class="section"><a href="#msps-Client_Application_Examples">6.4. Client Application Examples</a></span></dt></dl></div><p>The <span class="application"><strong>Mobicents SIP Presence Service</strong></span> is built on top of <span class="application"><strong>Mobicents JAIN SLEE</strong></span>. JAIN SLEE applications can be deployed and run in the same JVM as the servers. There are also XDM and SIP Presence client enablers that can be integrated into these JAIN SLEE applications, allowing for easy interaction with the platform servers.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="msps-XDM_Client_Enabler"/>6.1. XDM Client JAIN SLEE Enabler</h2></div></div></div><p>The <span class="application"><strong>Mobicents SIP Presence</strong></span> exposes a JAIN SLEE enabler for applications that can interact as clients of the XDM Server. The enabler is an extension of the XDM Client Enabler which exists in Mobicents JAIN SLEE. The only difference is that upon requests targeting the local and integrated XDM Server, the enabler does not uses XCAP or SIP network protocols, thus providing better performance and less overhead to network communications.</p><p>Please refer to the bundled JAIN SLEE documentation for complete details about how to integrate the enabler. The only difference to note in this document is the configuration of the client JAIN SLEE application SBB's XML Descriptor. The extended XDM Client Enabler SBB has the following ID:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">InternalXDMClientControlSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mobicents</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>This means that when integrating the enabler, the Parent's (the client application) Sbb XML Descriptor will refer to the ID above, instead of:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">XDMClientChildSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mobicents</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="msps-sip_event_publication_client_enabler"/>6.2. The Mobicents SIP Event Publication Client Enabler</h2></div></div></div><p>The <span class="application"><strong>Mobicents SIP Event Publication</strong></span> exposes a JAIN SLEE enabler for applications that want to interact as clients of a SIP Event Publication Server. The enabler does not use SIP network protocols, thus providing better performance and less overhead to network communications.</p><p>The Enabler is an SBB that can be used in child relations, with a simple synchronous interface.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="msps-sip_event_publication_client_enabler-integrating"/>6.2.1. Integrating the Mobicents SIP Event Publication Client Enabler</h3></div></div></div><p>This chapter explains how to setup a JAIN SLEE Service Sbb to use the Enabler.</p><p>A Service's Sbb will define the Enabler's Sbb as a child. To achieve that it will need to setup the XML Descriptor, Abstract Class and SbbLocalObject interface.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>The Service's Sbb will be referred to as the Parent Sbb in the following sections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_publication_client_enabler-parent_sbb_local_object_interface"/>6.2.1.1. The Parent's SbbLocalObject Interface</h4></div></div></div><p>The Mobicents SIP Event Publication Client Enabler Sbb does not provides asynchronous callbacks to the Parent's Sbb at the moment, that is, all operations invoked in the child sbb will return a response. Thus the Parent does not needs to implement a specific interface.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_publication_client_enabler-parent_sbb_abstract_class"/>6.2.1.2. The Parent's Sbb Abstract Class</h4></div></div></div><p>The Enabler's Sbb is a Child Sbb, and JAIN SLEE 1.1 Child Relations requires an abstract method in the Sbb Abstract Class, to retrieve the <code class="literal">javax.slee.ChildRelation</code> object, which is used to create or access specific Child Sbbs. This method should be:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_type">ChildRelation</span><span class="java_plain">&nbsp;getSIPEventPublicationClientChildRelation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_publication_client_enabler-parent_sbb_xml_descriptor"/>6.2.1.3. The Parent's Sbb XML Descriptor</h4></div></div></div><p>The Parent's Sbb must define a reference to the Enabler's Child Sbb, declare which is the method name to get the related ChildRelation object, and also ensure the SbbLocalObject interface is defined correctly.</p><p>A reference to the Enabler's Child Sbb is defined right after the Parent's Sbb Vendor ID element, using the following XML element:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">PublicationControlSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mobicents</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-alias</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sipEventPublicationClientChildSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-alias</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>The method name to get the Enabler's ChildRelation object must be defined after the CMP Fields (if any), this XML element links the sbb-alias previously defined with the abstract method declared in the Parent's Sbb Abstract Class:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-child-relation-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-alias-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sipEventPublicationClientChildSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-alias-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-child-relation-method-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">getSIPEventPublicationClientChildRelation</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">get-child-relation-method-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default-priority</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default-priority</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">get-child-relation-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="msps-sip_event_publication_client_enabler--using"/>6.2.2. Using the Mobicents SIP Event Publication Client Enabler</h3></div></div></div><p>In the last section we integrated the Enabler in the JAIN SLEE Service's Sbb, the Parent Sbb, in this section it is explained how to use the Enabler's Sbb, the Child Sbb.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_publication_client_enabler-the_child_sbblocalobject_interface"/>6.2.2.1. The Child's SbbLocalObject Interface</h4></div></div></div><p>The Mobicents SIP Event Publication Client Enabler Sbb, the Child Sbb, implements the <code class="literal">org.mobicents.slee.sipevent.server.publication.PublicationClientControlSbbLocalObject</code>, which extends the <code class="literal">javax.slee.SbbLocalObject</code> and <code class="literal">org.mobicents.slee.sipevent.server.publication.PublicationClientControl</code> interfaces, the latter declares the methods which can be used to interact with the PS and/or RLS:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">sipevent</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">publication</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">PublicationClientControl</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Result</span><span class="java_plain">&nbsp;newPublication</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;document</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentType</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentSubType</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Result</span><span class="java_plain">&nbsp;refreshPublication</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eTag</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">Result</span><span class="java_plain">&nbsp;modifyPublication</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eTag</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;document</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentType</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentSubType</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;removePublication</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;entity</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eTag</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div class="variablelist"><dl><dt><span class="term">The <code class="literal">newPublication(String, String, String, String, String, int)</code> method:</span></dt><dd><p>Requests a new publication, for the specified Entity and SIP Event Package.</p></dd><dt><span class="term">The <code class="literal">refreshPublication(String, String, String, int)</code> method:</span></dt><dd><p>Requests a publication refresh, for the specified Entity, SIP Event Package and ETag.</p></dd><dt><span class="term">The <code class="literal">modifyPublication(String, String, String, String, String, String, int)</code> method:</span></dt><dd><p>Requests a publication modification, for the specified Entity, SIP Event Package and ETag.</p></dd><dt><span class="term">The <code class="literal">removePublicationOk(String, String, String)</code> method:</span></dt><dd><p>Requests a publication removal, for the specified Entity, SIP Event Package and ETag.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_publication_client_enabler-creating_and_retrieving_the_child_sbb"/>6.2.2.2. Creating And Retrieving The Child Sbb</h4></div></div></div><p>The Child Relation in the Parent Sbb Abstract Class is used to create and retrieve the Child Sbb, it is important to not forget to pass the Parent's SbbLocalObject to the Child after creation:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">PublicationClientControl</span><span class="java_plain">&nbsp;getPresenceClientChildSbb</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">ChildRelation</span><span class="java_plain">&nbsp;childRelation&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getSIPEventPublicationClientChildRelation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">childRelation</span><span class="java_separator">.</span><span class="java_plain">isEmpty</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;creates&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;instance</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">PublicationClientControl</span><span class="java_separator">)</span><span class="java_plain">&nbsp;childRelation</span><span class="java_separator">.</span><span class="java_plain">create</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tracer</span><span class="java_separator">.</span><span class="java_plain">severe</span><span class="java_separator">(</span><span class="java_literal">&quot;Failed&nbsp;to&nbsp;create&nbsp;child&nbsp;sbb&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;e</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;reuse&nbsp;the&nbsp;existent&nbsp;one</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">PublicationClientControl</span><span class="java_separator">)</span><span class="java_plain">&nbsp;childRelation</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="msps-sip_event_subscription_client_enabler"/>6.3. The Mobicents SIP Event Subscription Client Enabler</h2></div></div></div><p>The <span class="application"><strong>Mobicents SIP Event Publication</strong></span> exposes a JAIN SLEE enabler for applications which want to interact as clients of a SIP Event Subscription Server, such as a PS or RLS. The enabler does not uses SIP network protocols, thus providing better performance and less overhead to network communications.</p><p>The Enabler is an SBB, which can be used in child relations, with a simple asynchronous interface.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="msps-sip_event_subscription_client_enabler-integrating"/>6.3.1. Integrating the Mobicents SIP Event Subscription Client Enabler</h3></div></div></div><p>This chapter explains how to setup a JAIN SLEE Service Sbb to use the Enabler.</p><p>In short terms, a Service's Sbb will define the Enabler's Sbb as a child, and to achieve that it will need to setup the XML Descriptor, Abstract Class and SbbLocalObject interface.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>The Service's Sbb will be referred as the Parent Sbb in the following sections.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_subscription_client_enabler-parent_sbb_local_object_interface"/>6.3.1.1. The Parent's SbbLocalObject Interface</h4></div></div></div><p>The Mobicents SIP Event Subscription Client Enabler Sbb provides asynchronous callbacks to the Parent's Sbb, and that can only be achieved if the Parent's SbbLocalObject extends a specific Java interface, deployed also by the Enabler, and provides it's SbbLocalObject to the Enabler's Sbb, through a specific method exposed by the latter interface. The Enabler stores the Parent's SbbLocalObject and uses it when a callback to the Parent's Sbb is needed.</p><p>The SbbLocalObject which must be used or extended by the Parent's Sbb is named <code class="literal">org.mobicents.slee.sipevent.server.subscription.SubscriptionClientControlParentSbbLocalObject</code>, which extends the <code class="literal">javax.slee.SbbLocalObject</code> and <code class="literal">org.mobicents.slee.sipevent.server.subscription.SubscriptionClientControlParent</code> interfaces, the latter declares the callbacks which must be implemented in the Parent's Sbb Abstract Class:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">sipevent</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">subscription</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">import</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">sipevent</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">subscription</span><span class="java_separator">.</span><span class="java_plain">data</span><span class="java_separator">.</span><span class="java_type">Subscription</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">SubscriptionClientControlParent</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;subscribeOk</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;responseCode</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;resubscribeOk</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;unsubscribeOk</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;subscribeError</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;error</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;resubscribeError</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;error</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;unsubscribeError</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;error</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;notifyEvent</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">Subscription</span><span class="java_separator">.</span><span class="java_type">Event</span><span class="java_plain">&nbsp;terminationReason</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">Subscription</span><span class="java_separator">.</span><span class="java_type">Status</span><span class="java_plain">&nbsp;status</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentType</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentSubtype</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div class="variablelist"><dl><dt><span class="term">The <code class="literal">subscribeOk(String, String, String, String, int, int)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the new subscription request succeed.</p></dd><dt><span class="term">The <code class="literal">resubscribeOk(String, String, String, String, int)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the refresh subscription request succeed.</p></dd><dt><span class="term">The <code class="literal">unsubscribeOk(String, String, String, String)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the remove subscription request succeed.</p></dd><dt><span class="term">The <code class="literal">subscribeError(String, String, String, String, int)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the new subscription request failed.</p></dd><dt><span class="term">The <code class="literal">resubscribeError(String, String, String, String, int)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the refresh subscription request failed.</p></dd><dt><span class="term">The <code class="literal">unsubscribeError(String, String, String, String, int)</code> method:</span></dt><dd><p>Callback from the Enabler indicating that the remove subscription request failed.</p></dd><dt><span class="term">The <code class="literal">notifyEvent(String, String, String, String, Subscription.Event, Subscription.Status, String, String, String)</code> method:</span></dt><dd><p>Callback from the Enabler notifying an event related with notifier state change.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_subscription_client_enabler-parent_sbb_abstract_class"/>6.3.1.2. The Parent's Sbb Abstract Class</h4></div></div></div><p>The Parent Sbb Abstract Class must implement the callbacks on it's SbbLocalObject, that is, must implement the <code class="literal">org.mobicents.slee.sipevent.server.subscription.SubscriptionClientControlParent</code> interface discussed in last section.</p><p>The Enabler's Sbb is a Child Sbb, and JAIN SLEE 1.1 Child Relations requires an abstract method in the Sbb Abstract Class, to retrieve the <code class="literal">javax.slee.ChildRelation</code> object, which is used to create or access specific Child Sbbs. This method should be:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">abstract</span><span class="java_plain">&nbsp;</span><span class="java_type">ChildRelation</span><span class="java_plain">&nbsp;getSIPEventSubscriptionClientChildRelation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_subscription_client_enabler-parent_sbb_xml_descriptor"/>6.3.1.3. The Parent's Sbb XML Descriptor</h4></div></div></div><p>The Parent's Sbb must define a reference to the Enabler's Child Sbb, declare which is the method name to get the related ChildRelation object, and also ensure the SbbLocalObject interface is defined correctly.</p><p>A reference to the Enabler's Child Sbb is defined right after the Parent's Sbb Vendor ID element, using the following XML element:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">SubscriptionControlSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">org.mobicents</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-vendor</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">1.0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-version</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-alias</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sipEventSubscriptionClientChildSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-alias</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>The method name to get the Enabler's ChildRelation object must be defined after the CMP Fields (if any), this XML element links the sbb-alias previously defined with the abstract method declared in the Parent's Sbb Abstract Class:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-child-relation-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-alias-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">sipEventSubscriptionClientChildSbb</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-alias-ref</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">get-child-relation-method-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">getSIPEventSubscriptionClientChildRelation</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">get-child-relation-method-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">default-priority</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">default-priority</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">get-child-relation-method</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>Finally, after the <code class="literal">sbb-abstract-class</code> element the Parent's SbbLocalObject interface name is defined:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-local-interface</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">sbb-local-interface-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">...</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-local-interface-name</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">sbb-local-interface</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="msps-sip_event_subscription_client_enabler-using"/>6.3.2. Using the Mobicents SIP Event Subscription Client Enabler</h3></div></div></div><p>In the last section we integrated the Enabler in the JAIN SLEE Service's Sbb, the Parent Sbb, in this section it is explained how to use the Enabler's Sbb, the Child Sbb.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_subscription_client_enabler-the_child_sbblocalobject_interface"/>6.3.2.1. The Child's SbbLocalObject Interface</h4></div></div></div><p>The Mobicents SIP Event Subscription Client Enabler Sbb, the Child Sbb, implements the <code class="literal">org.mobicents.slee.sipevent.server.subscription.SubscriptionClientControlSbbLocalObject</code>, which extends the <code class="literal">javax.slee.SbbLocalObject</code> and <code class="literal">org.mobicents.slee.sipevent.server.subscription.SubscriptionClientControlSbbLocalObject</code> interfaces, the latter declares the methods which can be used to interact with the SIP Event Subscription Server:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_keyword">package</span><span class="java_plain">&nbsp;org</span><span class="java_separator">.</span><span class="java_plain">mobicents</span><span class="java_separator">.</span><span class="java_plain">slee</span><span class="java_separator">.</span><span class="java_plain">sipevent</span><span class="java_separator">.</span><span class="java_plain">server</span><span class="java_separator">.</span><span class="java_plain">subscription</span><span class="java_separator">;</span>
</span>
<!--  --><br/><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_keyword">interface</span><span class="java_plain">&nbsp;</span><span class="java_type">SubscriptionClientControl</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;setParentSbb</span><span class="java_separator">(</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SubscriptionClientControlParentSbbLocalObject</span><span class="java_plain">&nbsp;sbbLocalObject</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;subscribe</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriberdisplayName</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;content</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentType</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;contentSubtype</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;resubscribe</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">int</span><span class="java_plain">&nbsp;expires</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">void</span><span class="java_plain">&nbsp;unsubscribe</span><span class="java_separator">(</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriber</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;notifier</span><span class="java_separator">,</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;eventPackage</span><span class="java_separator">,</span><span class="java_plain">&nbsp;</span><span class="java_type">String</span><span class="java_plain">&nbsp;subscriptionId</span><span class="java_separator">);</span>
</span>
<!--  --><br/><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre><div class="variablelist"><dl><dt><span class="term">The <code class="literal">setParentSbb(SubscriptionClientControlParentSbbLocalObject)</code> method:</span></dt><dd><p>Passes the Parent's SbbLocalObject, which will be used by the Child Sbb to provide async results. If not invoked after the child creation the Enabler won't be able to callback the Parent Sbb.</p></dd><dt><span class="term">The <code class="literal">subscribe(String, String, String, String, String, int, String, String, String)</code> method:</span></dt><dd><p>Requests a new subscription.</p></dd><dt><span class="term">The <code class="literal">resubscribe(String, String, String, String, int)</code> method:</span></dt><dd><p>Requests a subscription refresh.</p></dd><dt><span class="term">The <code class="literal">unsubscribe(String, String, String, String)</code> method:</span></dt><dd><p>Requests a subscription removal.</p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="msps-sip_event_subscription_client_enabler-creating_and_retrieving_the_child_sbb"/>6.3.2.2. Creating And Retrieving The Child Sbb</h4></div></div></div><p>The Child Relation in the Parent Sbb Abstract Class is used to create and retrieve the Child Sbb, it is important to not forget to pass the Parent's SbbLocalObject to the Child after creation:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="JAVA"></span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">public</span><span class="java_plain">&nbsp;</span><span class="java_type">SubscriptionClientControl</span><span class="java_plain">&nbsp;getSIPEventSubscriptionClientChildSbb</span><span class="java_separator">()</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">final</span><span class="java_plain">&nbsp;</span><span class="java_type">ChildRelation</span><span class="java_plain">&nbsp;childRelation&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;getSIPEventSubscriptionClientChildRelation</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">if</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_plain">childRelation</span><span class="java_separator">.</span><span class="java_plain">isEmpty</span><span class="java_separator">())</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">try</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;creates&nbsp;</span><span class="java_keyword">new</span><span class="java_plain">&nbsp;instance</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_type">SubscriptionClientControl</span><span class="java_plain">&nbsp;sbb&nbsp;</span><span class="java_operator">=</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">SubscriptionClientControl</span><span class="java_separator">)</span><span class="java_plain">&nbsp;childRelation</span><span class="java_separator">.</span><span class="java_plain">create</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;passes&nbsp;the&nbsp;parent&nbsp;sbb&nbsp;local&nbsp;object&nbsp;to&nbsp;the&nbsp;child</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sbb</span><span class="java_separator">.</span><span class="java_plain">setParentSbb</span><span class="java_separator">((</span><span class="java_type">SubscriptionClientControlParentSbbLocalObject</span><span class="java_separator">)</span><span class="java_plain">&nbsp;sbbContext</span><span class="java_separator">.</span><span class="java_plain">getSbbLocalObject</span><span class="java_separator">());</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;sbb</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span><span class="java_plain">&nbsp;</span><span class="java_keyword">catch</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">Exception</span><span class="java_plain">&nbsp;e</span><span class="java_separator">)</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tracer</span><span class="java_separator">.</span><span class="java_plain">severe</span><span class="java_separator">(</span><span class="java_literal">&quot;Failed&nbsp;to&nbsp;create&nbsp;child&nbsp;sbb&quot;</span><span class="java_separator">,</span><span class="java_plain">&nbsp;e</span><span class="java_separator">);</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_literal">null</span><span class="java_separator">;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">else</span><span class="java_plain">&nbsp;</span><span class="java_separator">{</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_operator">//</span><span class="java_plain">&nbsp;reuse&nbsp;the&nbsp;existent&nbsp;one</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_keyword">return</span><span class="java_plain">&nbsp;</span><span class="java_separator">(</span><span class="java_type">SubscriptionClientControl</span><span class="java_separator">)</span><span class="java_plain">&nbsp;childRelation</span><span class="java_separator">.</span><span class="java_plain">iterator</span><span class="java_separator">().</span><span class="java_plain">next</span><span class="java_separator">();</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="java_separator">}</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
<!--  --><br/><span class="java_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></pre></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="msps-Client_Application_Examples"/>6.4. Client Application Examples</h2></div></div></div><p>TODO</p></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="logging_traces_and_alarms"/>Chapter 7. Logging, Traces and Alarms</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#log4j_service">7.1. Log4j Logging Service</a></span></dt><dd><dl><dt><span class="section"><a href="#global_logging_config">7.1.1. Simplified Global Log4j Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="#alarm_facility">7.2. Alarms</a></span></dt><dt><span class="section"><a href="#trace_facility">7.3. Trace Facility</a></span></dt><dd><dl><dt><span class="section"><a href="#tracers_vs_log4j">7.3.1. JAIN SLEE Tracers and Log4j</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="log4j_service"/>7.1. Log4j Logging Service</h2></div></div></div><p>In Mobicents SIP Presence <code class="literal">Apache log4j</code> is used for logging. If you are not familiar with the log4j package and would like to use it in your applications, you can read more about it at the <a class="ulink" href="http://jakarta.apache.org/log4j/">Jakarta web site</a>.</p><p>Logging is controlled from a central <code class="filename">conf/jboss-log4j.xml</code> file in each server configuration profile. This file defines a set of appenders specifying the log files, what categories of messages should go there, the message format and the level of filtering. By default, Mobicents produces output to both the console and a log file (<code class="filename">log/server.log</code>).</p><p>There are 6 basic log levels used: TRACE, DEBUG, INFO, WARN, ERROR and FATAL.</p><p>Logging is organized into categories and appenders. Appenders control the destination of log entries. Different appenders differ in configuration, however each supports thresholds. Threshold filters log entries based on their level. A threshold set to WARN will allow log entries to pass into the appender if the level is WARN, ERROR or FATAL. Other entries will be discarded. For more details on appender configuration, please refer to its documentation or java doc.</p><p>The logging threshold on the console is INFO by default. However, there is no threshold set for the server.log file, so all generated logging messages are logged there.</p><p>Categories control the level for loggers and its children. For details, please refer to the log4j manual. </p><p>By default, Mobicents SIP Presence inherits a level of INFO from the root logger. To make the platform add more detailed logs, the <code class="filename">conf/jboss-log4j.xml</code> file has to be altered. Explicit category definition for Mobicents SIP Presence looks like:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.slee&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;INFO&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>This limits the level of logging to INFO for all Mobicents SIP Presence classes. It is possible to declare more categories with different levels, to provide logs with greater detail.</p><p>For instance, to provide detailed information on the Mobicents SIP Presence transaction engine in a separate log file (<code class="filename">txmanager.log</code>), the <code class="filename">conf/jboss-log4j.xml</code> file should contain entries as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">appender</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TXMANAGER&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.logging.appender.RollingFileAppender&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">errorHandler</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.logging.util.OnlyOnceErrorHandler&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;File&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;${jboss.server.home.dir}/log/txmanager.log&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Append&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;MaxFileSize&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500KB&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;MaxBackupIndex&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">layout</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.apache.log4j.PatternLayout&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ConversionPattern&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;%d&nbsp;%-5p&nbsp;[%c]&nbsp;%m%n&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">appender</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.slee.runtime.transaction&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEBUG&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">appender-ref</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TXMANAGER&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>This creates a new file appender and specifies that it should be used by the logger (or category) for the package org.mobicents.slee.runtime.transaction.</p><p>The file appender is set up to produce a new log file every day rather than producing a new one every time you restart the server or writing to a single file indefinitely. The current log file is txmanager.log. Older files have the date they were written added to their filenames.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="global_logging_config"/>7.1.1. Simplified Global Log4j Configuration</h3></div></div></div><p>Besides manual logging configuration, described previously, Mobicents SIP Presence also exposes management operations that greatly simplify such configuration, allowing the administrator to select from predefined and complete logging configuration presets. These operations are available in the <code class="filename">org.mobicents.slee%3Aservice%3DMobicentsManagement</code> MBean. The available presets are:</p><div class="variablelist"><dl><dt><span class="term">Level</span></dt><dd><div class="variablelist"><dl><dt><span class="term">DEFAULT</span></dt><dd><p>
                						Regular logging, at INFO level, displaying most user-related messages;
                					</p></dd><dt><span class="term">DEBUG</span></dt><dd><p>
                						More verbose logging, mostly using DEBUG/TRACE level, displaying message of interest for developers;
                					</p></dd><dt><span class="term">PRODUCTION</span></dt><dd><p>
                						Low verbosity and async logging, mostly in WARN level, for systems in production so that logging does impact performance.
                					</p></dd></dl></div></dd></dl></div><p>The available management operations are:</p><div class="variablelist"><dl><dt><span class="term">JMX Operation</span></dt><dd><div class="variablelist"><dl><dt><span class="term">getLoggingConfiguration</span></dt><dd><p>Retrieves the current logging configuration;</p></dd><dt><span class="term">switchLoggingConfiguration</span></dt><dd><p>Allows switching between configuration presets;</p></dd><dt><span class="term">setLoggingConfiguration</span></dt><dd><p>Used to upload a complete logging configuration.</p></dd></dl></div></dd></dl></div><p>Custom presets can be easily deployed in the application server too. Simply name the configuration file as <code class="filename">jboss-log4j.xml.PRESET_NAME</code>, where <code class="literal">PRESET_NAME</code> should be a unique preset name, and copy it into the <code class="filename">$JBOSS_HOME/server/profile_name/deploy/mobicents-slee/log4j-templates</code> directory, where <span class="application"><strong>profile_name</strong></span> is the server profile name.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>These procedures change the whole platform logging configuration, so it will also affect logging for other running applications besides the SIP Presence elements.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="alarm_facility"/>7.2. Alarms</h2></div></div></div><p>Currently Mobicents SIP Presence does not uses JAIN SLEE Alarms.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="trace_facility"/>7.3. Trace Facility</h2></div></div></div><p>Notification sources such as SBBs, Resource Adaptors, Profiles, and SLEE internal components use the <code class="literal">JAIN SLEE Trace Facility</code> to generate trace messages intended for consumption by external management clients. Management clients register to receive trace messages generated by the <code class="literal">Trace Facility</code> through the external management interface (MBean). Filters can be applied in a similar way to Alarms.</p><p>Within the SLEE, notification sources use a <code class="literal">tracer</code> to emit trace messages. A tracer is a named entity. Tracer names are case-sensitive and follow the Java hierarchical naming conventions. A tracer is considered to be an ancestor of another tracer if its name followed by a dot is a prefix of the descendant tracer’s name. A tracer is considered to be a parent of a tracer if there are no ancestors between itself and the descendant tracer. For example, the tracer named <code class="literal">com</code> is the parent tracer of the tracer named <code class="literal">com.foo</code> and an ancestor of the tracer named <code class="literal">com.foo.bar</code>.</p><p>All tracers are implicitly associated with a notification source, which identifies the object in the SLEE that is emitting the trace message, and is included in trace notifications generated by the <code class="literal">Trace MBean</code> on behalf of the tracer. For instance, an SBB notification source is composed by the SBB ID and the Service ID.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Multiple notification sources may have tracers with same name in SLEE. Comparing with common logging frameworks, this would mean that the notification source would be part of the log category or name.</p></div><p>For further information on how to use <code class="literal">JAIN SLEE Trace Facility</code> and receive JMX notifications refer to the JAIN SLEE 1.1 Specification.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="tracers_vs_log4j"/>7.3.1. JAIN SLEE Tracers and Log4j</h3></div></div></div><p>Mobicents SIP Presence Tracers additionally log messages to <span class="application"><strong>Apache Log4j</strong></span>, being the log4j category, for notification source <code class="literal">X</code>, defined as <code class="literal">javax.slee.</code> concatenated with the <code class="literal">X.toString()</code>.</p><p>For instance, the full log4j logger <code class="literal">name</code> for tracer named <code class="literal">GoogleTalkBotSbb</code>, of sbb notification source with <code class="literal">SbbID[name=GoogleTalkBotSbb,vendor=mobicents,version=1.0]</code> and <code class="literal">ServiceID[name=GoogleTalkBotService,vendor=mobicents,version=1.0]</code>, would be <code class="literal">javax.slee.SbbNotification[service=ServiceID[name=GoogleTalkBotService, vendor=mobicents,version=0.1], sbb=SbbID[name=GoogleTalkBotSbb,vendor=mobicents, version=0.1]].GoogleTalkBotSbb</code> (without the spaces or breaks), which means a log4j category defining its level as <code class="literal">DEBUG</code> could be:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.slee.SbbNotification[service=ServiceID[name=GoogleTalkBotService,</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;vendor=mobicents,version=0.1],sbb=SbbID[name=GoogleTalkBotSbb,</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;vendor=mobicents,version=0.1]]&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEBUG&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>The relation of JAIN SLEE <code class="literal">tracers</code> and log4j <code class="literal">loggers</code> goes beyond log4j showing tracer's messages. Changing the tracer's log4j logger <code class="literal">effective level</code> changes the tracer level in SLEE, and vice-versa. Since JAIN SLEE tracer levels differ from log4j logger levels, the table below maps the two:</p><div class="table"><a id="d0e2487"/><p class="title"><b>Table 7.1. Mapping JAIN SLEE Tracer Levels with Apache Log4j Logger Levels</b></p><div class="table-contents"><table summary="Mapping JAIN SLEE Tracer Levels with Apache Log4j Logger Levels" width="100%" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Tracer Level</th><th>Logger Level</th></tr></thead><tbody><tr><td>OFF</td><td>OFF</td></tr><tr><td>SEVERE</td><td>ERROR</td></tr><tr><td>WARNING</td><td>WARN</td></tr><tr><td>INFO</td><td>INFO</td></tr><tr><td>CONFIG</td><td>INFO</td></tr><tr><td>FINE</td><td>DEBUG</td></tr><tr><td>FINER</td><td>DEBUG</td></tr><tr><td>FINEST</td><td>TRACE</td></tr></tbody></table></div></div><br class="table-break"/></div></div></div><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="spsug-appe-Publican-Revision_History"/>Appendix A. Revision History</h2></div></div></div><p>
		<div class="revhistory"><table border="0" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 4</td><td align="left">Fri Jun 24 2011</td><td align="left"><span class="author"><span class="firstname">Eduardo</span> <span class="surname">Martins</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Documentation update for Mobicents SIP Presence Service 1.0.0.CR1.</td></tr></table>
				</td></tr><tr><td align="left">Revision 3.1</td><td align="left">Fri Dec 11 2009</td><td align="left"><span class="author"><span class="firstname">Eduardo</span> <span class="surname">Martins</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Migration to Mobicents JAIN SLEE 2.x introduces major refactoring, specially on configurations.</td></tr></table>
				</td></tr><tr><td align="left">Revision 3.0</td><td align="left">Fri Jul 10 2009</td><td align="left"><span class="author"><span class="firstname">Eduardo</span> <span class="surname">Martins</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Major update to include XDM Server authentication and authorization, creation of XCAP Application Usages, SIP Client configuration examples and Resource List Server.</td></tr></table>
				</td></tr><tr><td align="left">Revision 2.0</td><td align="left">Fri Mar 06 2009</td><td align="left"><span class="author"><span class="firstname">Douglas</span> <span class="surname">Silas</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>First release of the "parameterized" and much-improved Mobicents documentation.</td></tr></table>
				</td></tr><tr><td align="left">Revision 1.0</td><td align="left">Tue Jan 20 2009</td><td align="left"><span class="author"><span class="firstname">Douglas</span> <span class="surname">Silas</span></span></td></tr><tr><td align="left" colspan="3">
					<table class="simplelist" border="0" summary="Simple list"><tr><td>Creation of the Mobicents SIP Presence User Guide separate from the Mobicents Platform User Guide.</td></tr></table>
				</td></tr></table></div>
	</p></div><div class="index"><div class="titlepage"><div><div><h2 class="title"><a id="d0e2630"/>Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>architecture, <a class="indexterm" href="#Architecture_of_the_SIP_Presence_Service">Architecture of the Mobicents SIP Presence Service</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>feedback, <a class="indexterm" href="#d0e365">Provide feedback to the authors!</a></dt></dl></div></div></div></div></body></html>