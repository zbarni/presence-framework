<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 9. Advanced Topics</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="JAIN SLEE User Guide"/><link rel="up" href="index.html" title="JAIN SLEE User Guide"/><link rel="prev" href="slee_1_1_extensions.html" title="Chapter 8. JAIN SLEE 1.1 Extensions"/><link rel="next" href="jdk-installing_configuring_and_running.html" title="Appendix A. Java Development Kit (JDK): Installing, Configuring and Running"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="slee_1_1_extensions.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="jdk-installing_configuring_and_running.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="advanced_topics"/>Chapter 9. Advanced Topics</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="advanced_topics.html#classloading">9.1. Class Loading</a></span></dt><dt><span class="section"><a href="advanced_topics.html#congestion_control">9.2. Congestion Control</a></span></dt><dd><dl><dt><span class="section"><a href="advanced_topics.html#congestion_control_configuration">9.2.1. Congestion Control Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="advanced_topics.html#jpa_slee_profiles_mapping">9.3. JAIN SLEE 1.1 Profiles JPA Mapping</a></span></dt><dd><dl><dt><span class="section"><a href="advanced_topics.html#profile_jpa_tables_and_columns">9.3.1. Profile Specification JPA Tables And columns</a></span></dt><dt><span class="section"><a href="advanced_topics.html#profile_jpa_datasource">9.3.2. Profile Specification JPA Datasource</a></span></dt></dl></dd><dt><span class="section"><a href="advanced_topics.html#testing_tck">9.4. Testing the JAIN SLEE 1.1 TCK</a></span></dt><dt><span class="section"><a href="advanced_topics.html#eclipse_ide">9.5. Setting JAIN SLEE Source Code Projects in Eclipse IDE</a></span></dt></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="classloading"/>9.1. Class Loading</h2></div></div></div><p>Each JAIN SLEE Component has its own classloader (<code class="literal">ComponentClassLoader</code>) in the package named <code class="literal">org.mobicents.slee.container.component.deployment.classloading</code>. This classloader sees the component classes contained in the component jar (<code class="literal">URLClassLoaderDomain</code>) by declaring it as the parent classloader, and adding the classes seen by each component it refers. It does not see classes from a component that it does not depend on.
  </p><p>JAIN SLEE defines a class loading domain with the <acronym class="acronym">API</acronym>s required in the JAIN SLEE 1.1 container (for example, JAIN SLEE, <acronym class="acronym">JBDC</acronym> and <acronym class="acronym">JMX</acronym>). This domain (<code class="literal">JBoss Microcontainer ClassLoadingDomain</code>) imports all classes shared in the JBoss Application Server, and acts like the parent domain for all <code class="literal">URLClassLoaderDomain</code>s, which means that a class imported by a SLEE classloading domain will always be used first.</p><div class="figure"><a id="d0e2525"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/classloading.png" align="middle" alt="Classloading example in Mobicents JAIN SLEE"/></div></div><p class="title"><b>Figure 9.1. Classloading example in Mobicents JAIN SLEE</b></p></div><br class="figure-break"/><div class="itemizedlist"><ul><li><p>The <code class="literal">SIP INVITE Event</code> component refers to the <code class="literal">JAIN SIP Library</code> in its XML descriptor, and its classloader domain depends on the classloader domain of the JAIN SIP Library.</p></li><li><p>The <code class="literal">SIP RA Type</code> component refers to all Events in the SIP RA Event jar in its XML descriptor, and its classloader domain depends on the classloader domain of the SIP Event JAR and inherits its dependencies, including the JAIN SIP library classloading domain.</p></li><li><p>The <code class="literal">SIP RA</code> component refers to the <code class="literal">SIP RA Type</code> component in its XML descriptor, and its classloader domain depends on the classloader domain of the SIP RA Type Component jar, and inherits its dependencies. This includes the SIP Event jar and JAIN SIP library classloading domains.</p></li><li><p>The <code class="literal">SBB</code> component refers to the <code class="literal">SIP RA Type</code> component and <code class="literal">SIP INVITE Event</code> in its XML descriptor. Its classloader domain depends on the class loader domain of the SIP RA Type Component jar, and inherits its dependencies; the SIP Event jar and the JAIN SIP library classloading domains. It also depends on the classloader domain of the SIP Event jar.</p></li></ul></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>JBoss Application Server does not see the classes of deployed JAIN SLEE components. This means that if it exports its classes for components that are complemented with Java EE components, the common classes must be deployed on JBoss Application Server, either directly or included in the Java EE component.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="congestion_control"/>9.2. Congestion Control</h2></div></div></div><p>JAIN SLEE can monitor the memory available in the JVM. In case it drops to a certain level (percentage), new events and/or activity startups are rejected, and at the same time a JAIN SLEE Alarm (which can send JMX notifications) is raised. This feature is called Congestion Control, and the container will turn it off automatically once another available memory level is reached.</p><p>If Congestion Control rejects an operation, a <code class="classname">javax.slee.SleeException</code> is thrown. This means that if the feature is to be used, the Resource Adaptors and Applications need to handle such use case, and behave properly.</p><p>The type of JAIN SLEE Alarm raised is <span class="application"><strong>org.mobicents.slee.management.alarm.congestion</strong></span>.</p><p>Congestion Control is turned off by default.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="congestion_control_configuration"/>9.2.1. Congestion Control Configuration</h3></div></div></div><p>The Congestion Control feature is configured through an XML file or through a JMX MBean. Changes applied through JMX are not persisted, and once the container is restarted the configuration will revert to the one in the XML file.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="congestion_control_persistent_configuration"/>9.2.1.1. Congestion Control Persistent Configuration</h4></div></div></div><p>Configuration is done through a XML descriptor for each <a class="xref" href="configuration_and_running.html#server_profiles" title="3.1. Server Profiles">Section 3.1, “Server Profiles”</a>. The XML file is named <code class="filename">jboss-beans.xml</code> and is located at <code class="filename">$JBOSS_HOME/server/profile_name/deploy/mobicents-slee/META-INF</code>, where <span class="application"><strong>profile_name</strong></span> is the server profile name.</p><p>The configuration is exposed a JBoss Microcontainer Bean:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">bean</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Mobicents.JAINSLEE.CongestionControlConfiguration&quot;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.slee.container.management.jmx.CongestionControlConfiguration&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">annotation</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;org.mobicents.slee:name=CongestionControlConfiguration&quot;,exposedInterface=</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.mobicents.slee.container.management.jmx.CongestionControlConfigurationMBean.class,</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerDirectly=true)</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">annotation</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;periodBetweenChecks&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">0</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;minFreeMemoryToTurnOn&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">10</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;minFreeMemoryToTurnOff&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">20</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;refuseStartActivity&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">true</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">property</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;refuseFireEvent&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">false</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">property</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">bean</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><div class="table"><a id="d0e2613"/><p class="title"><b>Table 9.1. JAIN SLEE Congestion Control Bean Configuration</b></p><div class="table-contents"><table summary="JAIN SLEE Congestion Control Bean Configuration" width="100%" border="1"><colgroup><col/><col/><col/></colgroup><thead><tr><th>Property Name</th><th>Property Type</th><th>Description</th></tr></thead><tbody><tr><td>periodBetweenChecks</td><td>int</td><td>The available memory level is checked periodically, this property defines the period, in seconds, between these checks, and if set to 0 turns off the Congestion Control feature.</td></tr><tr><td>minFreeMemoryToTurnOn</td><td>int</td><td>This property defines the minimum free memory percentage, which if reached turns ON the Congestion Control feature.</td></tr><tr><td>minFreeMemoryToTurnOff</td><td>int</td><td>This property defines the minimum free memory percentage, which if reached turns OFF the Congestion Control feature. This value should be considerably higher than minFreeMemoryToTurnOn, otherwise the feature may be turning on and off all the time.</td></tr><tr><td>refuseStartActivity</td><td>boolean</td><td>If true and the Congestion Control feature is ON, the container rejects activity startups, no matter it's a request from a Resource Adaptor or SBB.</td></tr><tr><td>refuseFireEvent</td><td>boolean</td><td>If true and the Congestion Control feature is ON, the container rejects the firing of events, no matter it's a request from a Resource Adaptor or SBB.</td></tr></tbody></table></div></div><br class="table-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h4 class="title"><a id="congestion_control_jmx_configuration"/>9.2.1.2. Congestion Control JMX Configuration</h4></div></div></div><p>Through JMX, the Congestion Control feature configuration can be changed with the container running. These configuration changes are not persisted.</p><p>The JMX MBean which can be used to change the Congestion Control configuration is named <span class="application"><strong>org.mobicents.slee:name=CongestionControlConfiguration</strong></span>, and provides getters and setters to change each property defined in the persistent configuration. The JMX Console can be used to use this MBean, see <a class="xref" href="management.html#management_jmx_console" title="4.4.1. JMX Console">Section 4.4.1, “JMX Console”</a>.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="jpa_slee_profiles_mapping"/>9.3. JAIN SLEE 1.1 Profiles JPA Mapping</h2></div></div></div><p>As mentioned in the containers configuration section, Mobicents JAIN SLEE uses JPA to store all JAIN SLEE 1.1 Profiles, and in mentioned section it was explained how to define which JPA / Hibernate data source. In this section more details are provided about how JAIN SLEE 1.1 Profiles are mapped to a JPA datasource schema.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="profile_jpa_tables_and_columns"/>9.3.1. Profile Specification JPA Tables And columns</h3></div></div></div><p>
    For each Profile Specification, at least one <acronym class="acronym">JPA</acronym> Table is created, and is named <code class="literal">SLEE_PE_</code> concatenated with the Profile CMP interface simple name (<code class="literal">obtained as java.lang.Class.getSimpleName()</code>), then <code class="literal">_</code>, and finally the absolute value of the <code class="literal">hashCode()</code> method of the javax.slee.ComponentID of the Profile Specification.
    </p><p>
    This table has a primary key composed by the profile name and profile table name, and a column for each attribute of the Profile Specification CMP, except for those of array type. Those columns are named <code class="literal">C</code>, concatenated with the cmp attribute name.
    </p><p>
    For each Profile CMP attribute of <em class="parameter"><code>array</code></em> type, a join table is created, and is named <code class="literal">SLEE_PEAAV_</code> concatenated with the Profile CMP interface simple name (<code class="literal">obtained as java.lang.Class.getSimpleName()</code>), then <code class="literal">_</code>, then the absolute value of <code class="literal">hashCode()</code> method of the javax.slee.ComponentID of the Profile Specification, and finally the CMP attribute name. This table has a generated primary key column named <code class="literal">ID</code>, the foreign key, and two columns to store the CMP attribute value:
    </p><div class="variablelist"><dl><dt><span class="term"><code class="literal">SERIALIZABLE</code></span></dt><dd><p>
          Used to store the value if its type does not allow it to be converted to a String.
          </p></dd><dt><span class="term"><code class="literal">STRING</code></span></dt><dd><p>
          Used when the CMP attribute type can be converted to a <code class="literal">java.lang.String</code>, for instance an <code class="literal">Integer</code>.
          </p></dd></dl></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="profile_jpa_datasource"/>9.3.2. Profile Specification JPA Datasource</h3></div></div></div><p>Unless configured manually, Mobicents JAIN SLEE uses the default datasource of JBoss Application Server. Please refer to its documentation to learn about it.</p></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="testing_tck"/>9.4. Testing the JAIN SLEE 1.1 TCK</h2></div></div></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="orderedlist"><p>To run the JAIN SLEE 1.1 TCK:</p><ol><li><p>Checkout and build the container source code as explained in <a class="xref" href="install.html" title="Chapter 2. Installing Mobicents JAIN SLEE">Chapter 2, <i>Installing Mobicents JAIN SLEE</i></a>.</p></li><li><p>Install the TCK Resource Adaptor and Plugin:</p><pre class="screen">cd tck/jain-slee-1.1
mvn install</pre></li><li><p>Setup JAVA_OPTS environment variable to include -XX:MaxPermSize=128M -Djboss.defined.home=<code class="literal">/Volumes/2/jboss-5.1.0.GA</code> -Djava.security.manager=default -Djava.security.policy=<code class="literal">file:///Volumes/2/workspace/mobicents-jainslee-2/</code>tck/jain-slee-1.1/tck-security.policy, replacing the <code class="literal">absolute paths</code> with $JBOSS_HOME and the path of the svn checkout.</p></li><li><p>Unzip and run the JAIN SLEE 1.1 TCK distribution:</p><pre class="screen">unzip testsuite.zip
cd testsuite
ant</pre><div class="important"><h2>Important</h2><p>No test should fail.</p></div></li></ol></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="eclipse_ide"/>9.5. Setting JAIN SLEE Source Code Projects in Eclipse IDE</h2></div></div></div><p>The JAIN SLEE Core, each RA, and each example, are worked out with separated Eclipse IDE Projects.</p><p>
    There are two alternatives to set up a specific project:
    </p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2795"/><p class="title"><b>Procedure 9.1. Via Command Line</b></p><ol class="1"><li><p>
        In the checked out directory of the project, and with Eclipse IDE closed, open a terminal.
        </p></li><li><p>
        Run the following:
        </p><pre class="screen">
]mvn mobicents:eclipse
mvn -Declipse.workspace=YOUR_RELATIVE_PATH_TO_ECLIPSE_WORKSPACE eclipse:add-maven-repo
        </pre></li><li><p>
        Install M2Eclipse if you want to do maven builds within Eclipse.
        </p></li></ol></div><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="procedure"><a id="d0e2809"/><p class="title"><b>Procedure 9.2. With Eclipse IDE</b></p><ul><li><p>
        Install the M2Eclipse plugin and use "Import..." and subselect the "Maven Projects" feature.
        </p><div class="important"><h2>Important</h2><p>
          Ensure the "Resolve Workspace projects" and "Separate projects for modules" in the "Advanced" options on the bottom of the window are turned off. If the project is large, such as the JAIN SLEE Core, M2Eclipse may be a considerable slower option, due to dynamic Maven2 Dependency Management.
          </p></div></li></ul></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="slee_1_1_extensions.html"><strong>Prev</strong>Chapter 8. JAIN SLEE 1.1 Extensions</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="jdk-installing_configuring_and_running.html"><strong>Next</strong>Appendix A. Java Development Kit (JDK): Installin...</a></li></ul></body></html>