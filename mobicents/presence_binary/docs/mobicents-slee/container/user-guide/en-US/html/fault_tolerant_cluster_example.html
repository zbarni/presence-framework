<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Appendix C. Fault Tolerant Clustering - A Concrete Example</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="JAIN SLEE User Guide"/><link rel="up" href="index.html" title="JAIN SLEE User Guide"/><link rel="prev" href="jboss_home_setup.html" title="Appendix B. Setting the JBOSS_HOME Environment Variable"/><link rel="next" href="revision_history.html" title="Appendix D. Revision History"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="jboss_home_setup.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="revision_history.html"><strong>Next</strong></a></li></ul><div class="appendix" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="fault_tolerant_cluster_example"/>Appendix C. Fault Tolerant Clustering - A Concrete Example</h2></div></div></div><p>In order to highlight the behavior of the Mobicents JAIN SLEE server when run in fault tolerant clustering mode, a concrete situation is described below.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ft_example_overview"/>C.1. Example Overview</h2></div></div></div><p>The example below outlines a situation where two Mobicents JAIN SLEE nodes (<code class="literal">Node-1</code> and <code class="literal">Node-2</code>) are configured to run in fault tolerant mode. Both nodes have the same deployable unit containing a custom <acronym class="acronym">SBB</acronym>. A null activity <acronym class="acronym">ACI</acronym> is used by the <acronym class="acronym">SBB</acronym>s to communicate.</p><p>The service is a simple application that relays information received in <acronym class="acronym">SIP</acronym> INFO messages to another incoming <acronym class="acronym">SIP</acronym> dialog. This might for example be a rudimentary chat application. The flow outlines the clustered execution of the base case of this application, e.g. receive one message on one dialog and send it out on another dialog.</p><p>The example starts with the creation of two <acronym class="acronym">SBB</acronym> entities. One of the entities is the receiver, and the other one is the sender. The receiver will create an <acronym class="acronym">ACI</acronym> and register this with the <acronym class="acronym">ACI</acronym> naming facility. The sender retrieves the <acronym class="acronym">ACI</acronym> and sends a message to the receiver using an event. The example ends when the receiver sends the acquired message on its <acronym class="acronym">SIP</acronym> dialog as an INFO message.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ft_example_step1"/>C.2. Creating Sbb entities</h2></div></div></div><p>The base case starts with a <acronym class="acronym">SIP</acronym> INVITE being received in <code class="literal">Node-1</code>. The event will be routed inside <code class="literal">Node-1</code> and trigger the creation of a new <acronym class="acronym">SBB</acronym> entity (<code class="literal">Sbb-1</code>). The <acronym class="acronym">SBB</acronym> entity in turn create and attach to a new null activity <acronym class="acronym">ACI</acronym> (<code class="literal">ACI-1</code>). Concurrently another <acronym class="acronym">SIP</acronym> INVITE is received in <code class="literal">Node-2</code>, which causes the JAIN SLEE container to create another <acronym class="acronym">SBB</acronym> entity (<code class="literal">Sbb-2</code>). Both <acronym class="acronym">ACI</acronym>s and <acronym class="acronym">SBB</acronym>s are fully clustered, so even though they are created in different physical nodes, they are logically inside the same container. In the image below, the cloud represents this logical relationship.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>Note that balancer is not a requirement. It is present in this example to show basic message flow with balancer in front of deployed containers.</p></div><div class="figure"><a id="d0e3603"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/slee-clustering1.png" align="middle" alt="Fault tolerant cluster consisting of two nodes that both have one created on SBB entity for chat application. The SIP load balancer is multiplexing the SIP traffic."/></div></div><p class="title"><b>Figure C.1. Fault tolerant cluster consisting of two nodes that both have one created on SBB entity for chat application. The SIP load balancer is multiplexing the SIP traffic.</b></p></div><br class="figure-break"/></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="ft_example_step2"/>C.3. Relaying the Message</h2></div></div></div><p>After the <acronym class="acronym">SBB</acronym>s have been set up, a <acronym class="acronym">SIP</acronym> INFO is received by <code class="literal">Node-2</code> and relayed to <code class="literal">Sbb-2</code>. <code class="literal">Sbb-2</code> then looks up <code class="literal">ACI-1</code> from the ACI naming facility. <code class="literal">Node-2</code> retrieves the clustered state of <code class="literal">ACI-1</code> and de-serializes it for <code class="literal">Sbb-2</code>. Note that this means that <code class="literal">ACI-1</code> is currently being handled in <code class="literal">Node-2</code>.</p><p>When <code class="literal">ACI-1</code> has been retrieved from the cluster, <code class="literal">Sbb-2</code> fires a MessageEvent on <code class="literal">ACI-1</code>. Since events are not clustered, the event will be routed only on <code class="literal">Node-2</code>. The event will, however, be delivered to all attached <acronym class="acronym">SBB</acronym>s. This is achieved by <code class="literal">Node-2</code> retrieving the <code class="literal">Sbb-1</code> entity from the cluster and delivering the event to it.</p><p>The MessageEvent is parsed by <code class="literal">Sbb-1</code> and an outgoing <acronym class="acronym">SIP</acronym> INFO message is constructed with the appropriate payload. <code class="literal">Sbb-1</code> then forwards the INFO message to the SipRA. The incoming <acronym class="acronym">SIP</acronym> dialog that spawned <code class="literal">Sbb-1</code> is in <code class="literal">Node-1</code>, hence the SipRA will retrieve the activity object from the cluster and send the INFO message. The <acronym class="acronym">SIP</acronym> load balancer will then handle de-multiplexing. Note that retrieving the activity object from the clustered state only works because the SipRA is explicitly handling the replication of the SIP activity objects. Had another <acronym class="acronym">RA</acronym> than the SipRA been used, a similar kind of clustering would have been needed to be implemented using the <code class="literal">FaultTolerantResourceAdaptor</code> interfaces.</p><div class="figure"><a id="d0e3699"/><div class="figure-contents"><div class="mediaobject" align="center"><img src="images/slee-clustering2.png" align="middle" alt="The situation when relaying the INFO message. Both SBB entities are running in the same node."/></div></div><p class="title"><b>Figure C.2. The situation when relaying the INFO message. Both SBB entities are running in the same node.</b></p></div><br class="figure-break"/></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="jboss_home_setup.html"><strong>Prev</strong>Appendix B. Setting the JBOSS_HOME Environment Va...</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="revision_history.html"><strong>Next</strong>Appendix D. Revision History</a></li></ul></body></html>