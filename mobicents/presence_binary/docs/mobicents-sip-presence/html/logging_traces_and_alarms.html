<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">Chapter 7. Logging, Traces and Alarms</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL Stylesheets V1.74.0"/><link rel="home" href="index.html" title="SIP Presence Service User Guide"/><link rel="up" href="index.html" title="SIP Presence Service User Guide"/><link rel="prev" href="msps-Client_Applications.html" title="Chapter 6. Client JAIN SLEE Applications"/><link rel="next" href="spsug-appe-Publican-Revision_History.html" title="Appendix A. Revision History"/></head><body><p id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><ul class="docnav"><li class="previous"><a accesskey="p" href="msps-Client_Applications.html"><strong>Prev</strong></a></li><li class="next"><a accesskey="n" href="spsug-appe-Publican-Revision_History.html"><strong>Next</strong></a></li></ul><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="logging_traces_and_alarms"/>Chapter 7. Logging, Traces and Alarms</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="logging_traces_and_alarms.html#log4j_service">7.1. Log4j Logging Service</a></span></dt><dd><dl><dt><span class="section"><a href="logging_traces_and_alarms.html#global_logging_config">7.1.1. Simplified Global Log4j Configuration</a></span></dt></dl></dd><dt><span class="section"><a href="logging_traces_and_alarms.html#alarm_facility">7.2. Alarms</a></span></dt><dt><span class="section"><a href="logging_traces_and_alarms.html#trace_facility">7.3. Trace Facility</a></span></dt><dd><dl><dt><span class="section"><a href="logging_traces_and_alarms.html#tracers_vs_log4j">7.3.1. JAIN SLEE Tracers and Log4j</a></span></dt></dl></dd></dl></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="log4j_service"/>7.1. Log4j Logging Service</h2></div></div></div><p>In Mobicents SIP Presence <code class="literal">Apache log4j</code> is used for logging. If you are not familiar with the log4j package and would like to use it in your applications, you can read more about it at the <a class="ulink" href="http://jakarta.apache.org/log4j/">Jakarta web site</a>.</p><p>Logging is controlled from a central <code class="filename">conf/jboss-log4j.xml</code> file in each server configuration profile. This file defines a set of appenders specifying the log files, what categories of messages should go there, the message format and the level of filtering. By default, Mobicents produces output to both the console and a log file (<code class="filename">log/server.log</code>).</p><p>There are 6 basic log levels used: TRACE, DEBUG, INFO, WARN, ERROR and FATAL.</p><p>Logging is organized into categories and appenders. Appenders control the destination of log entries. Different appenders differ in configuration, however each supports thresholds. Threshold filters log entries based on their level. A threshold set to WARN will allow log entries to pass into the appender if the level is WARN, ERROR or FATAL. Other entries will be discarded. For more details on appender configuration, please refer to its documentation or java doc.</p><p>The logging threshold on the console is INFO by default. However, there is no threshold set for the server.log file, so all generated logging messages are logged there.</p><p>Categories control the level for loggers and its children. For details, please refer to the log4j manual. </p><p>By default, Mobicents SIP Presence inherits a level of INFO from the root logger. To make the platform add more detailed logs, the <code class="filename">conf/jboss-log4j.xml</code> file has to be altered. Explicit category definition for Mobicents SIP Presence looks like:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.slee&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;INFO&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>This limits the level of logging to INFO for all Mobicents SIP Presence classes. It is possible to declare more categories with different levels, to provide logs with greater detail.</p><p>For instance, to provide detailed information on the Mobicents SIP Presence transaction engine in a separate log file (<code class="filename">txmanager.log</code>), the <code class="filename">conf/jboss-log4j.xml</code> file should contain entries as follows:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">appender</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TXMANAGER&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.logging.appender.RollingFileAppender&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">errorHandler</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.jboss.logging.util.OnlyOnceErrorHandler&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;File&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;${jboss.server.home.dir}/log/txmanager.log&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;Append&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;false&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;MaxFileSize&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;500KB&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;MaxBackupIndex&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;1&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">layout</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">class</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.apache.log4j.PatternLayout&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">param</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;ConversionPattern&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;%d&nbsp;%-5p&nbsp;[%c]&nbsp;%m%n&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">layout</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">appender</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;org.mobicents.slee.runtime.transaction&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEBUG&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">appender-ref</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">ref</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;TXMANAGER&quot;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>This creates a new file appender and specifies that it should be used by the logger (or category) for the package org.mobicents.slee.runtime.transaction.</p><p>The file appender is set up to produce a new log file every day rather than producing a new one every time you restart the server or writing to a single file indefinitely. The current log file is txmanager.log. Older files have the date they were written added to their filenames.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="global_logging_config"/>7.1.1. Simplified Global Log4j Configuration</h3></div></div></div><p>Besides manual logging configuration, described previously, Mobicents SIP Presence also exposes management operations that greatly simplify such configuration, allowing the administrator to select from predefined and complete logging configuration presets. These operations are available in the <code class="filename">org.mobicents.slee%3Aservice%3DMobicentsManagement</code> MBean. The available presets are:</p><div class="variablelist"><dl><dt><span class="term">Level</span></dt><dd><div class="variablelist"><dl><dt><span class="term">DEFAULT</span></dt><dd><p>
                						Regular logging, at INFO level, displaying most user-related messages;
                					</p></dd><dt><span class="term">DEBUG</span></dt><dd><p>
                						More verbose logging, mostly using DEBUG/TRACE level, displaying message of interest for developers;
                					</p></dd><dt><span class="term">PRODUCTION</span></dt><dd><p>
                						Low verbosity and async logging, mostly in WARN level, for systems in production so that logging does impact performance.
                					</p></dd></dl></div></dd></dl></div><p>The available management operations are:</p><div class="variablelist"><dl><dt><span class="term">JMX Operation</span></dt><dd><div class="variablelist"><dl><dt><span class="term">getLoggingConfiguration</span></dt><dd><p>Retrieves the current logging configuration;</p></dd><dt><span class="term">switchLoggingConfiguration</span></dt><dd><p>Allows switching between configuration presets;</p></dd><dt><span class="term">setLoggingConfiguration</span></dt><dd><p>Used to upload a complete logging configuration.</p></dd></dl></div></dd></dl></div><p>Custom presets can be easily deployed in the application server too. Simply name the configuration file as <code class="filename">jboss-log4j.xml.PRESET_NAME</code>, where <code class="literal">PRESET_NAME</code> should be a unique preset name, and copy it into the <code class="filename">$JBOSS_HOME/server/profile_name/deploy/mobicents-slee/log4j-templates</code> directory, where <span class="application"><strong>profile_name</strong></span> is the server profile name.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>These procedures change the whole platform logging configuration, so it will also affect logging for other running applications besides the SIP Presence elements.</p></div></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="alarm_facility"/>7.2. Alarms</h2></div></div></div><p>Currently Mobicents SIP Presence does not uses JAIN SLEE Alarms.</p></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="trace_facility"/>7.3. Trace Facility</h2></div></div></div><p>Notification sources such as SBBs, Resource Adaptors, Profiles, and SLEE internal components use the <code class="literal">JAIN SLEE Trace Facility</code> to generate trace messages intended for consumption by external management clients. Management clients register to receive trace messages generated by the <code class="literal">Trace Facility</code> through the external management interface (MBean). Filters can be applied in a similar way to Alarms.</p><p>Within the SLEE, notification sources use a <code class="literal">tracer</code> to emit trace messages. A tracer is a named entity. Tracer names are case-sensitive and follow the Java hierarchical naming conventions. A tracer is considered to be an ancestor of another tracer if its name followed by a dot is a prefix of the descendant tracer’s name. A tracer is considered to be a parent of a tracer if there are no ancestors between itself and the descendant tracer. For example, the tracer named <code class="literal">com</code> is the parent tracer of the tracer named <code class="literal">com.foo</code> and an ancestor of the tracer named <code class="literal">com.foo.bar</code>.</p><p>All tracers are implicitly associated with a notification source, which identifies the object in the SLEE that is emitting the trace message, and is included in trace notifications generated by the <code class="literal">Trace MBean</code> on behalf of the tracer. For instance, an SBB notification source is composed by the SBB ID and the Service ID.</p><div xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="important"><h2>Important</h2><p>Multiple notification sources may have tracers with same name in SLEE. Comparing with common logging frameworks, this would mean that the notification source would be part of the log category or name.</p></div><p>For further information on how to use <code class="literal">JAIN SLEE Trace Facility</code> and receive JMX notifications refer to the JAIN SLEE 1.1 Specification.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="tracers_vs_log4j"/>7.3.1. JAIN SLEE Tracers and Log4j</h3></div></div></div><p>Mobicents SIP Presence Tracers additionally log messages to <span class="application"><strong>Apache Log4j</strong></span>, being the log4j category, for notification source <code class="literal">X</code>, defined as <code class="literal">javax.slee.</code> concatenated with the <code class="literal">X.toString()</code>.</p><p>For instance, the full log4j logger <code class="literal">name</code> for tracer named <code class="literal">GoogleTalkBotSbb</code>, of sbb notification source with <code class="literal">SbbID[name=GoogleTalkBotSbb,vendor=mobicents,version=1.0]</code> and <code class="literal">ServiceID[name=GoogleTalkBotService,vendor=mobicents,version=1.0]</code>, would be <code class="literal">javax.slee.SbbNotification[service=ServiceID[name=GoogleTalkBotService, vendor=mobicents,version=0.1], sbb=SbbID[name=GoogleTalkBotSbb,vendor=mobicents, version=0.1]].GoogleTalkBotSbb</code> (without the spaces or breaks), which means a log4j category defining its level as <code class="literal">DEBUG</code> could be:</p><pre xmlns="" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="XML"><!-- XML : generated by JHighlight v1.0 (http://jhighlight.dev.java.net) -->
<span class="xml_plain"></span><br />
<span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">category</span><span class="xml_plain"></span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_attribute_name">name</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;javax.slee.SbbNotification[service=ServiceID[name=GoogleTalkBotService,</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;vendor=mobicents,version=0.1],sbb=SbbID[name=GoogleTalkBotSbb,</span><br />
<span class="xml_attribute_value">&nbsp;&nbsp;&nbsp;&nbsp;vendor=mobicents,version=0.1]]&quot;</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="xml_tag_symbols">&lt;</span><span class="xml_tag_name">priority</span><span class="xml_plain">&nbsp;</span><span class="xml_attribute_name">value</span><span class="xml_tag_symbols">=</span><span class="xml_attribute_value">&quot;DEBUG&quot;</span><span class="xml_plain">&nbsp;</span><span class="xml_tag_symbols">/&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_tag_symbols">&lt;/</span><span class="xml_tag_name">category</span><span class="xml_tag_symbols">&gt;</span><span class="xml_plain">&nbsp;</span><br />
<span class="xml_plain">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br />
</pre><p>The relation of JAIN SLEE <code class="literal">tracers</code> and log4j <code class="literal">loggers</code> goes beyond log4j showing tracer's messages. Changing the tracer's log4j logger <code class="literal">effective level</code> changes the tracer level in SLEE, and vice-versa. Since JAIN SLEE tracer levels differ from log4j logger levels, the table below maps the two:</p><div class="table"><a id="d0e2487"/><p class="title"><b>Table 7.1. Mapping JAIN SLEE Tracer Levels with Apache Log4j Logger Levels</b></p><div class="table-contents"><table summary="Mapping JAIN SLEE Tracer Levels with Apache Log4j Logger Levels" width="100%" border="1"><colgroup><col/><col/></colgroup><thead><tr><th>Tracer Level</th><th>Logger Level</th></tr></thead><tbody><tr><td>OFF</td><td>OFF</td></tr><tr><td>SEVERE</td><td>ERROR</td></tr><tr><td>WARNING</td><td>WARN</td></tr><tr><td>INFO</td><td>INFO</td></tr><tr><td>CONFIG</td><td>INFO</td></tr><tr><td>FINE</td><td>DEBUG</td></tr><tr><td>FINER</td><td>DEBUG</td></tr><tr><td>FINEST</td><td>TRACE</td></tr></tbody></table></div></div><br class="table-break"/></div></div></div><ul class="docnav"><li class="previous"><a accesskey="p" href="msps-Client_Applications.html"><strong>Prev</strong>Chapter 6. Client JAIN SLEE Applications</a></li><li class="up"><a accesskey="u" href="#"><strong>Top of page</strong></a></li><li class="home"><a accesskey="h" href="index.html"><strong>Front page</strong></a></li><li class="next"><a accesskey="n" href="spsug-appe-Publican-Revision_History.html"><strong>Next</strong>Appendix A. Revision History</a></li></ul></body></html>